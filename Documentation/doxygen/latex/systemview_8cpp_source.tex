\hypertarget{systemview_8cpp_source}{}\subsection{systemview.\+cpp}
\label{systemview_8cpp_source}\index{systemview.\+cpp@{systemview.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * The MIT License (MIT)}
00003 \textcolor{comment}{ *}
00004 \textcolor{comment}{ * Copyright (c) 2015 David Krepsky}
00005 \textcolor{comment}{ *}
00006 \textcolor{comment}{ * Permission is hereby granted, free of charge, to any person obtaining a copy}
00007 \textcolor{comment}{ * of this software and associated documentation files (the "Software"), to deal}
00008 \textcolor{comment}{ * in the Software without restriction, including without limitation the rights}
00009 \textcolor{comment}{ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}
00010 \textcolor{comment}{ * copies of the Software, and to permit persons to whom the Software is}
00011 \textcolor{comment}{ * furnished to do so, subject to the following conditions:}
00012 \textcolor{comment}{ *}
00013 \textcolor{comment}{ * The above copyright notice and this permission notice shall be included in}
00014 \textcolor{comment}{ * all copies or substantial portions of the Software.}
00015 \textcolor{comment}{ *}
00016 \textcolor{comment}{ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}
00017 \textcolor{comment}{ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}
00018 \textcolor{comment}{ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE}
00019 \textcolor{comment}{ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}
00020 \textcolor{comment}{ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,}
00021 \textcolor{comment}{ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE}
00022 \textcolor{comment}{ * SOFTWARE.}
00023 \textcolor{comment}{ */}
00024 
00043 \textcolor{preprocessor}{#include "\hyperlink{barproperties_8h}{window/barproperties.h}"}
00044 \textcolor{preprocessor}{#include "\hyperlink{lineproperties_8h}{window/lineproperties.h}"}
00045 
00046 \textcolor{preprocessor}{#include "\hyperlink{systemview_8h}{graphics/systemview.h}"}
00047 \textcolor{preprocessor}{#include <QColor>}
00048 \textcolor{preprocessor}{#include <QBrush>}
00049 
00050 \textcolor{keyword}{const} qreal SystemView::kZoomStep = 0.05;
00051 
00052 \textcolor{comment}{/*******************************************************************************}
00053 \textcolor{comment}{ * Constructor.}
00054 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00055}{}\hyperlink{group___graphics_ga660a455ff7b98cb92410b0bf1cbb2eeb}{00055} \hyperlink{group___graphics_ga660a455ff7b98cb92410b0bf1cbb2eeb}{SystemView::SystemView}(QWidget *parent) :
00056   QGraphicsView(parent)
00057 \{
00058   setDragMode(RubberBandDrag);
00059   \textcolor{comment}{// Enable antialiasing}
00060   setRenderHints(QPainter::Antialiasing | QPainter::SmoothPixmapTransform);
00061 
00062   setScene(\textcolor{keyword}{new} QGraphicsScene(\textcolor{keyword}{this}));
00063 
00064   barDoubleClick = \textcolor{keyword}{new} QSignalMapper(\textcolor{keyword}{this});
00065   lineDoubleClick = \textcolor{keyword}{new} QSignalMapper(\textcolor{keyword}{this});
00066 
00067   \textcolor{comment}{// Create mapper for bar properties.}
00068   connect(barDoubleClick, SIGNAL(mapped(QObject *)), \textcolor{keyword}{this},
00069           SIGNAL(\hyperlink{class_system_view_a90bd4b070c8abaa5995899154421eb44}{barProperties}(QObject *)));
00070 
00071   \textcolor{comment}{// Create mapper for line properties.}
00072   connect(lineDoubleClick, SIGNAL(mapped(QObject *)), \textcolor{keyword}{this},
00073           SIGNAL(\hyperlink{class_system_view_a58c4a0bf68178ab59066819118214360}{lineProperties}(QObject *)));
00074 
00075 \}
00076 
00077 \textcolor{comment}{/*******************************************************************************}
00078 \textcolor{comment}{ * Destructor.}
00079 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00080}{}\hyperlink{group___graphics_ga0091352981c1efa5498819b69698db44}{00080} \hyperlink{group___graphics_ga0091352981c1efa5498819b69698db44}{SystemView::~SystemView}()
00081 \{
00082 
00083 \}
00084 
00085 \textcolor{comment}{/*******************************************************************************}
00086 \textcolor{comment}{ * zoomIn.}
00087 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00088}{}\hyperlink{group___graphics_ga93170319ee5fbf9098353b383fc8a368}{00088} \textcolor{keywordtype}{void} \hyperlink{group___graphics_ga93170319ee5fbf9098353b383fc8a368}{SystemView::zoomIn}()
00089 \{
00090   scale(1.0 + kZoomStep, 1.0 + kZoomStep);
00091 \}
00092 
00093 \textcolor{comment}{/*******************************************************************************}
00094 \textcolor{comment}{ * zoomOut.}
00095 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00096}{}\hyperlink{group___graphics_gaf971471c76265ec21cdde2aafe9b609f}{00096} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gaf971471c76265ec21cdde2aafe9b609f}{SystemView::zoomOut}()
00097 \{
00098   scale(1.0 - kZoomStep, 1.0 - kZoomStep);
00099 \}
00100 
00101 \textcolor{comment}{/*******************************************************************************}
00102 \textcolor{comment}{ * zoomFit.}
00103 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00104}{}\hyperlink{group___graphics_gac1bf0b6a80216df74a8da1cb8ac5f0e8}{00104} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gac1bf0b6a80216df74a8da1cb8ac5f0e8}{SystemView::zoomFit}()
00105 \{
00106   fitInView(sceneRect(), Qt::KeepAspectRatio);
00107 \}
00108 
00109 \textcolor{comment}{/*******************************************************************************}
00110 \textcolor{comment}{ * addNetwork.}
00111 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00112}{}\hyperlink{group___graphics_gae183447d0777c7b2b940a977f9b64c3f}{00112} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gae183447d0777c7b2b940a977f9b64c3f}{SystemView::addNetwork}(\hyperlink{class_network}{Network} *network)
00113 \{
00114   \textcolor{keywordflow}{foreach} (\hyperlink{class_bar}{Bar} *bar, network->\hyperlink{class_network_a7fe628f7de34a96235cbd3f2cee4aff2}{bars}) \{
00115     \hyperlink{group___graphics_gac4e02019d41c203c788ff1e6f3ee460e}{addBar}(bar);
00116   \}
00117 
00118   \textcolor{keywordflow}{foreach} (\hyperlink{class_line}{Line} *line, network->\hyperlink{class_network_acda0fd42e712e460a08a0e96511ee7eb}{lines}) \{
00119     \hyperlink{group___graphics_gaed2fb15d518cab9a52ea1ee258846bfc}{addLine}(line);
00120   \}
00121 \}
00122 
00123 \textcolor{comment}{/*******************************************************************************}
00124 \textcolor{comment}{ * removeNetwork.}
00125 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00126}{}\hyperlink{group___graphics_ga2078ad08ff93b9a8683d567e3f9f714e}{00126} \textcolor{keywordtype}{void} \hyperlink{group___graphics_ga2078ad08ff93b9a8683d567e3f9f714e}{SystemView::removeNetwork}(\hyperlink{class_network}{Network} *network)
00127 \{
00128 
00129   \textcolor{keywordflow}{foreach} (\hyperlink{class_bar}{Bar} *bar, network->\hyperlink{class_network_a7fe628f7de34a96235cbd3f2cee4aff2}{bars}) \{
00130     \hyperlink{group___graphics_ga1e96b08395a2f1b961dedbb3e8c99a50}{removeBar}(bar);
00131   \}
00132 
00133   \textcolor{keywordflow}{foreach} (\hyperlink{class_line}{Line} *line, network->\hyperlink{class_network_acda0fd42e712e460a08a0e96511ee7eb}{lines}) \{
00134     \hyperlink{group___graphics_ga4af1d763d9b9c02933e62d1f6231ad18}{removeLine}(line);
00135   \}
00136 \}
00137 
\hypertarget{systemview_8cpp_source_l00138}{}\hyperlink{group___graphics_gac4e02019d41c203c788ff1e6f3ee460e}{00138} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gac4e02019d41c203c788ff1e6f3ee460e}{SystemView::addBar}(\hyperlink{class_bar}{Bar} *bar)
00139 \{
00140   scene()->addItem(bar);
00141 
00142   \textcolor{comment}{// Connect signals.}
00143   connect(bar, SIGNAL(eventDoubleClick()), barDoubleClick, SLOT(map()));
00144   barDoubleClick->setMapping(bar, bar);
00145 \}
00146 
\hypertarget{systemview_8cpp_source_l00147}{}\hyperlink{group___graphics_ga1e96b08395a2f1b961dedbb3e8c99a50}{00147} \textcolor{keywordtype}{void} \hyperlink{group___graphics_ga1e96b08395a2f1b961dedbb3e8c99a50}{SystemView::removeBar}(\hyperlink{class_bar}{Bar} *bar)
00148 \{
00149   scene()->removeItem(bar);
00150 
00151   disconnect(bar, SIGNAL(eventDoubleClick()), barDoubleClick, SLOT(map()));
00152   barDoubleClick->removeMappings(bar);
00153 \}
00154 
\hypertarget{systemview_8cpp_source_l00155}{}\hyperlink{group___graphics_gaed2fb15d518cab9a52ea1ee258846bfc}{00155} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gaed2fb15d518cab9a52ea1ee258846bfc}{SystemView::addLine}(\hyperlink{class_line}{Line} *line)
00156 \{
00157   scene()->addItem(line);
00158 
00159   \textcolor{comment}{// Connect signals.}
00160   connect(line, SIGNAL(eventDoubleClick()), lineDoubleClick, SLOT(map()));
00161   lineDoubleClick->setMapping(line, line);
00162 \}
00163 
\hypertarget{systemview_8cpp_source_l00164}{}\hyperlink{group___graphics_ga4af1d763d9b9c02933e62d1f6231ad18}{00164} \textcolor{keywordtype}{void} \hyperlink{group___graphics_ga4af1d763d9b9c02933e62d1f6231ad18}{SystemView::removeLine}(\hyperlink{class_line}{Line} *line)
00165 \{
00166   scene()->removeItem(line);
00167   disconnect(line, SIGNAL(eventDoubleClick()), lineDoubleClick, SLOT(map()));
00168   lineDoubleClick->removeMappings(line);
00169 \}
00170 
00171 \textcolor{comment}{/*******************************************************************************}
00172 \textcolor{comment}{ * wheelEvent.}
00173 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00174}{}\hyperlink{group___graphics_gaab2fa6cebf9022eb6bf31497c0789675}{00174} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gaab2fa6cebf9022eb6bf31497c0789675}{SystemView::wheelEvent}(QWheelEvent *event)
00175 \{
00176   setTransformationAnchor(QGraphicsView::AnchorUnderMouse);
00177 
00178   \textcolor{keywordflow}{if} (event->delta() > 0) \{
00179     scale(1.0 + kZoomStep, 1.0 + kZoomStep);
00180   \} \textcolor{keywordflow}{else} \{
00181     scale(1.0 - kZoomStep, 1.0 - kZoomStep);
00182   \}
00183 \}
00184 
00185 \textcolor{comment}{/*******************************************************************************}
00186 \textcolor{comment}{ * mouseMoveEvent.}
00187 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00188}{}\hyperlink{group___graphics_gab19e233cd697852dd71140971cb6e122}{00188} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gab19e233cd697852dd71140971cb6e122}{SystemView::mouseMoveEvent}(QMouseEvent *event)
00189 \{
00190   \textcolor{keywordflow}{if} (event->buttons().testFlag(Qt::MidButton)) \{
00191     QScrollBar *hBar = horizontalScrollBar();
00192     QScrollBar *vBar = verticalScrollBar();
00193     QPoint delta = \textcolor{keyword}{event}->pos() - oldPos;
00194     oldPos = \textcolor{keyword}{event}->pos();
00195     hBar->setValue(hBar->value() + (isRightToLeft() ? delta.x() : -delta.x()));
00196     vBar->setValue(vBar->value() - delta.y());
00197   \}
00198 
00199   QGraphicsView::mouseMoveEvent(event);
00200 \}
00201 
00202 \textcolor{comment}{/*******************************************************************************}
00203 \textcolor{comment}{ * mousePressEvent.}
00204 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00205}{}\hyperlink{group___graphics_ga42d4a485d6d9bd891d9505a5213cf783}{00205} \textcolor{keywordtype}{void} \hyperlink{group___graphics_ga42d4a485d6d9bd891d9505a5213cf783}{SystemView::mousePressEvent}(QMouseEvent *event)
00206 \{
00207   \textcolor{keywordflow}{if}(event->button() == Qt::MidButton) \{
00208     oldPos = \textcolor{keyword}{event}->pos();
00209     setDragMode(NoDrag);
00210     setCursor(Qt::OpenHandCursor);
00211   \}
00212 
00213   QGraphicsView::mousePressEvent(event);
00214 \}
00215 
00216 \textcolor{comment}{/*******************************************************************************}
00217 \textcolor{comment}{ * mouseReleaseEvent.}
00218 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{systemview_8cpp_source_l00219}{}\hyperlink{group___graphics_gaa8a2664405194bbe29daa454aead7416}{00219} \textcolor{keywordtype}{void} \hyperlink{group___graphics_gaa8a2664405194bbe29daa454aead7416}{SystemView::mouseReleaseEvent}(QMouseEvent *event)
00220 \{
00221   \textcolor{keywordflow}{if}(event->button() == Qt::MidButton) \{
00222     setDragMode(RubberBandDrag);
00223     setCursor(Qt::ArrowCursor);
00224   \}
00225 
00226   QGraphicsView::mouseReleaseEvent(event);
00227 \}
00228 
\end{DoxyCode}
