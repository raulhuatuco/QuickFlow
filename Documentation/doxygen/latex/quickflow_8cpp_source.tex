\hypertarget{quickflow_8cpp_source}{}\subsection{quickflow.\+cpp}
\label{quickflow_8cpp_source}\index{quickflow.\+cpp@{quickflow.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * The MIT License (MIT)}
00003 \textcolor{comment}{ *}
00004 \textcolor{comment}{ * Copyright (c) 2015 David Krepsky}
00005 \textcolor{comment}{ *}
00006 \textcolor{comment}{ * Permission is hereby granted, free of charge, to any person obtaining a copy}
00007 \textcolor{comment}{ * of this software and associated documentation files (the "Software"), to deal}
00008 \textcolor{comment}{ * in the Software without restriction, including without limitation the rights}
00009 \textcolor{comment}{ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}
00010 \textcolor{comment}{ * copies of the Software, and to permit persons to whom the Software is}
00011 \textcolor{comment}{ * furnished to do so, subject to the following conditions:}
00012 \textcolor{comment}{ *}
00013 \textcolor{comment}{ * The above copyright notice and this permission notice shall be included in}
00014 \textcolor{comment}{ * all copies or substantial portions of the Software.}
00015 \textcolor{comment}{ *}
00016 \textcolor{comment}{ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}
00017 \textcolor{comment}{ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}
00018 \textcolor{comment}{ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE}
00019 \textcolor{comment}{ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}
00020 \textcolor{comment}{ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,}
00021 \textcolor{comment}{ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE}
00022 \textcolor{comment}{ * SOFTWARE.}
00023 \textcolor{comment}{ */}
00024 
00043 \textcolor{preprocessor}{#include "\hyperlink{quickflow_8h}{quickflow.h}"}
00044 \textcolor{preprocessor}{#include "ui\_quickflow.h"}
00045 
00046 
00047 \textcolor{preprocessor}{#include "\hyperlink{newproject_8h}{window/newproject.h}"}
00048 \textcolor{preprocessor}{#include "\hyperlink{about_8h}{window/about.h}"}
00049 
00050 \textcolor{preprocessor}{#include "\hyperlink{bar_8h}{models/bar.h}"}
00051 \textcolor{preprocessor}{#include "\hyperlink{line_8h}{models/line.h}"}
00052 \textcolor{preprocessor}{#include "\hyperlink{network_8h}{models/network.h}"}
00053 
00054 \textcolor{preprocessor}{#include "\hyperlink{import_8h}{algorithms/import.h}"}
00055 \textcolor{preprocessor}{#include "\hyperlink{redraw_8h}{algorithms/redraw.h}"}
00056 \textcolor{preprocessor}{#include "\hyperlink{shirmoharmmadi_8h}{algorithms/shirmoharmmadi.h}"}
00057 
00058 \textcolor{comment}{/*****************************************************************************}
00059 \textcolor{comment}{* Const.}
00060 \textcolor{comment}{*****************************************************************************/}
00061 \textcolor{keyword}{const} QString \hyperlink{group___window_gabfc3b1280bdae9a9c046d56b1459ab99}{QuickFlow::kVersion} = \textcolor{stringliteral}{"0.0.5"};
00062 
00063 \textcolor{comment}{/*******************************************************************************}
00064 \textcolor{comment}{ * Constructor.}
00065 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{quickflow_8cpp_source_l00066}{}\hyperlink{group___window_ga7689e2608835392fce3f4c95a7a542db}{00066} \hyperlink{group___window_ga7689e2608835392fce3f4c95a7a542db}{QuickFlow::QuickFlow}(QWidget *parent)
00067   : QMainWindow(parent),
00068     ui(new \hyperlink{namespace_ui}{Ui}::\hyperlink{class_quick_flow}{QuickFlow}),
00069     project(NULL),
00070     altered\_ (false)
00071 \{
00072   \textcolor{comment}{// Set-up user interface.}
00073   ui->setupUi(\textcolor{keyword}{this});
00074 
00075   \textcolor{comment}{// Adjust initial interface to disable project related actions.}
00076   noProjectInterface();
00077 
00078   \textcolor{comment}{// Set application info.}
00079   QCoreApplication::setOrganizationName(\textcolor{stringliteral}{"DKrepsky"});
00080   QCoreApplication::setOrganizationDomain(\textcolor{stringliteral}{"dkrepsky.blogspot.com.br"});
00081   QCoreApplication::setApplicationName(\textcolor{stringliteral}{"QuickFlow"});
00082   QCoreApplication::setApplicationVersion(\hyperlink{group___window_gabfc3b1280bdae9a9c046d56b1459ab99}{kVersion});
00083 
00084   \textcolor{comment}{// Check for settings existence and version.}
00085   settings = \textcolor{keyword}{new} QSettings(\textcolor{keyword}{this});
00086 
00087   \textcolor{keywordflow}{if} (settings->contains(\textcolor{stringliteral}{"version"})) \{
00088     \textcolor{keywordflow}{if} (settings->value(\textcolor{stringliteral}{"version"}).toString() == \hyperlink{group___window_gabfc3b1280bdae9a9c046d56b1459ab99}{kVersion})
00089       \textcolor{comment}{// If exists and is in the current version, use it.}
00090       loadSettings();
00091     \textcolor{keywordflow}{else}
00092       \textcolor{comment}{// Update to the new program version.}
00093       upgradeSettings();
00094   \} \textcolor{keywordflow}{else} \{
00095     \textcolor{comment}{// If there is no settings availiable, create a new one with default values.}
00096     createSettings();
00097   \}
00098 \}
00099 
00100 \textcolor{comment}{/*******************************************************************************}
00101 \textcolor{comment}{ * Destructor.}
00102 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{quickflow_8cpp_source_l00103}{}\hyperlink{group___window_ga985823a0db64246b3a15eed2f397e0a4}{00103} \hyperlink{group___window_ga985823a0db64246b3a15eed2f397e0a4}{QuickFlow::~QuickFlow}()
00104 \{
00105   \textcolor{keyword}{delete} ui;
00106 \}
00107 
00108 \textcolor{comment}{/*******************************************************************************}
00109 \textcolor{comment}{ * Is altered.}
00110 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{quickflow_8cpp_source_l00111}{}\hyperlink{group___window_ga5d9148467ef65c48419bf020ee107a45}{00111} \textcolor{keywordtype}{bool} \hyperlink{group___window_ga5d9148467ef65c48419bf020ee107a45}{QuickFlow::isAltered}()
00112 \{
00113   \textcolor{keywordflow}{return} altered\_;
00114 \}
00115 
00116 \textcolor{comment}{/*******************************************************************************}
00117 \textcolor{comment}{ * Set altered.}
00118 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{quickflow_8cpp_source_l00119}{}\hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{00119} \textcolor{keywordtype}{void} \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{QuickFlow::setAltered}(\textcolor{keywordtype}{bool} altered)
00120 \{
00121   altered\_ = altered;
00122 
00123   \textcolor{keywordflow}{if}(altered\_) \{
00124     ui->actionSave->setEnabled(\textcolor{keyword}{true});
00125     \textcolor{comment}{// Change window title to indicate that the project is altered.}
00126     setWindowTitle(\textcolor{stringliteral}{"QkFlow - *"} + project->\hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name});
00127   \} \textcolor{keywordflow}{else} \{
00128     ui->actionSave->setEnabled(\textcolor{keyword}{false});
00129     \textcolor{comment}{// Change window title to indicate that the project has been saved.}
00130     setWindowTitle(\textcolor{stringliteral}{"QkFlow - "} + project->\hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name});
00131   \}
00132 \}
00133 
00134 \textcolor{comment}{/*******************************************************************************}
00135 \textcolor{comment}{ * Zoom in action.}
00136 \textcolor{comment}{ ******************************************************************************/}
00137 \textcolor{keywordtype}{void} QuickFlow::on\_actionZoomIn\_triggered()
00138 \{
00139   ui->systemView->zoomIn();
00140 \}
00141 
00142 \textcolor{comment}{/*******************************************************************************}
00143 \textcolor{comment}{ * Zoom out action.}
00144 \textcolor{comment}{ ******************************************************************************/}
00145 \textcolor{keywordtype}{void} QuickFlow::on\_actionZoomOut\_triggered()
00146 \{
00147   ui->systemView->zoomOut();
00148 \}
00149 
00150 \textcolor{comment}{/*******************************************************************************}
00151 \textcolor{comment}{ * Zoom fit action.}
00152 \textcolor{comment}{ ******************************************************************************/}
00153 \textcolor{keywordtype}{void} QuickFlow::on\_actionZoomFit\_triggered()
00154 \{
00155   ui->systemView->zoomFit();
00156 \}
00157 
00158 \textcolor{comment}{/*******************************************************************************}
00159 \textcolor{comment}{ * Exit action.}
00160 \textcolor{comment}{ ******************************************************************************/}
00161 \textcolor{keywordtype}{void} QuickFlow::on\_actionExit\_triggered()
00162 \{
00163   close();
00164 \}
00165 
00166 \textcolor{comment}{/*******************************************************************************}
00167 \textcolor{comment}{ * New project action.}
00168 \textcolor{comment}{ ******************************************************************************/}
00169 \textcolor{keywordtype}{void} QuickFlow::on\_actionNew\_triggered()
00170 \{
00171   \textcolor{comment}{// Check if there is a project already opened.}
00172   \textcolor{keywordflow}{if} (project != NULL) \{
00173     \textcolor{comment}{// Close project}
00174     ui->actionClose->trigger();
00175 
00176     \textcolor{comment}{// If close didnt succed, cancel new project.}
00177     \textcolor{keywordflow}{if} (project != NULL) \textcolor{keywordflow}{return};
00178   \}
00179 
00180   \textcolor{comment}{// Open New Project window and gather the project settings.}
00181   \textcolor{comment}{// NOTE: windowNewProject MUST provide valid data.}
00182   \hyperlink{class_new_project}{NewProject} newProject(\textcolor{keyword}{this});
00183 
00184   \textcolor{comment}{// If canceled return}
00185   \textcolor{keywordflow}{if} (newProject.exec() != QDialog::Accepted) \{
00186     \textcolor{keywordflow}{return};
00187   \}
00188 
00189   \textcolor{comment}{// Create project object and fill settings.}
00190   project = \textcolor{keyword}{new} \hyperlink{class_project}{Project};
00191   project->\hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name} = newProject.dataName;
00192   project->\hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath} = newProject.dataPath + QDir::separator() +
00193                       newProject.dataName + \textcolor{stringliteral}{".qkf"};
00194 
00195   \textcolor{comment}{// Simulation data.}
00196   project->\hyperlink{class_project_abac6e194d2d16fbdbe51627844eae60b}{setMaxIterations}(newProject.dataMaxIterations);
00197   project->\hyperlink{class_project_a2cb776c39adb42a1113bf7887d0d4636}{setMinError}(newProject.dataMinError);
00198   project->\hyperlink{class_project_a494c3e89851f754188c7abaedbf77ef6}{setVoltageBase}(newProject.dataVoltageBase);
00199   project->\hyperlink{class_project_abb4df805b3cd3af509a41e657eb4bb83}{setPowerBase}(newProject.dataPowerBase);
00200 
00201   \textcolor{comment}{// Units.}
00202   project->\hyperlink{class_project_a846ee2284b0856d461b35d78d9f8e1d6}{setLengthUn}(newProject.dataLengthUnit);
00203   project->\hyperlink{class_project_a995d050781923522ae2a02728346d199}{setImpedanceUn}(newProject.dataImpedanceUnit);
00204   project->\hyperlink{class_project_aa26b488b2e93c8a8c6b4423ce07df4a1}{setVoltageUn}(newProject.dataVoltageUnit);
00205   project->\hyperlink{class_project_aa46b8645d2047c1a2e8d329b9ebbc120}{setPowerUn}(newProject.dataPowerUnit);
00206   project->\hyperlink{class_project_a64d9800bc3acafcfa4d3f45ee5aacc6d}{setCurrentUnit}(newProject.dataCurrentUnit);
00207 
00208   \textcolor{comment}{// Try to save project.}
00209   \textcolor{keywordtype}{bool} save\_ok = project->\hyperlink{class_project_a596a875bc5be73bc5b1b71b6448c1e07}{save}();
00210 
00211   \textcolor{keywordflow}{if} (!save\_ok) \{
00212     QMessageBox::critical(\textcolor{keyword}{this}, \textcolor{stringliteral}{"File write error"},
00213                           \textcolor{stringliteral}{"Cannot write .qkf file."}, QMessageBox::Ok);
00214     \textcolor{keyword}{delete} project;
00215     project = NULL;
00216     \textcolor{keywordflow}{return};
00217   \}
00218 
00219   \textcolor{comment}{// New project is Ok}
00220   \textcolor{comment}{// Change window title to indicate that the project is open}
00221   setWindowTitle(\textcolor{stringliteral}{"QkFlow - "} + newProject.dataName);
00222   \textcolor{comment}{// Enable interface}
00223   workInterface();
00224 \}
00225 
00226 \textcolor{comment}{/*******************************************************************************}
00227 \textcolor{comment}{ * Open project action.}
00228 \textcolor{comment}{ ******************************************************************************/}
00229 \textcolor{keywordtype}{void} QuickFlow::on\_actionOpen\_triggered()
00230 \{
00231   \textcolor{comment}{// Check if there is a project already opened.}
00232   \textcolor{keywordflow}{if} (project != NULL) \{
00233     \textcolor{comment}{// Close project.}
00234     ui->actionClose->trigger();
00235 
00236     \textcolor{comment}{// If close didnt succed, cancel new project.}
00237     \textcolor{keywordflow}{if} (project != NULL) \textcolor{keywordflow}{return};
00238   \}
00239 
00240   \textcolor{comment}{// Open file dialog to select the project file.}
00241   QFileDialog projectFile(\textcolor{keyword}{this});
00242   projectFile.setFileMode(QFileDialog::ExistingFile);
00243   projectFile.setAcceptMode(QFileDialog::AcceptOpen);
00244   projectFile.setNameFilter(tr(\textcolor{stringliteral}{"QkFlow Project (*.qkf)"}));
00245   projectFile.setDirectory(QStandardPaths::standardLocations(
00246                              QStandardPaths::HomeLocation)[0]);
00247 
00248   \textcolor{comment}{// Check if user has canceled the opening.}
00249   \textcolor{keywordflow}{if} (projectFile.exec() != QDialog::Accepted) \{
00250     \textcolor{keywordflow}{return};
00251   \}
00252 
00253   \textcolor{comment}{// Grab filename.}
00254   QString fileName = projectFile.selectedFiles()[0];
00255 
00256   \textcolor{comment}{// Create project object and load from file.}
00257   project = \textcolor{keyword}{new} \hyperlink{class_project}{Project};
00258   project->\hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath} = fileName;
00259 
00260   \textcolor{keywordflow}{if} (project->\hyperlink{class_project_a1e373892a0383371132ce68fa5f8813d}{load}() != \textcolor{keyword}{true}) \{
00261     QMessageBox::critical(\textcolor{keyword}{this}, \textcolor{stringliteral}{"File read error"}, \textcolor{stringliteral}{"Cannot read .qkf file."},
00262                           QMessageBox::Ok);
00263     \textcolor{keyword}{delete} project;
00264     project = NULL;
00265     \textcolor{keywordflow}{return};
00266   \}
00267 
00268   \textcolor{comment}{// New project is Ok.}
00269   \textcolor{comment}{// Change window title to indicate that the project is open.}
00270   setWindowTitle(\textcolor{stringliteral}{"QkFlow - "} + project->\hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name});
00271   \textcolor{comment}{// Enable interface.}
00272   workInterface();
00273 
00274   \textcolor{comment}{// Add networks}
00275   \textcolor{keywordflow}{foreach}(\hyperlink{class_network}{Network} *network, project->\hyperlink{class_project_a28c99cc1f0568fbc6f2428894acf3c3a}{networks}) \{
00276     ui->systemView->addNetwork(network);
00277   \}
00278 \}
00279 
00280 \textcolor{comment}{/*******************************************************************************}
00281 \textcolor{comment}{ * Save project action.}
00282 \textcolor{comment}{ ******************************************************************************/}
00283 \textcolor{keywordtype}{void} QuickFlow::on\_actionSave\_triggered()
00284 \{
00285   \textcolor{comment}{// Check for alterations}
00286   \textcolor{keywordflow}{if} (altered\_) \{
00287     \textcolor{keywordflow}{if} (project->\hyperlink{class_project_a596a875bc5be73bc5b1b71b6448c1e07}{save}() != \textcolor{keyword}{true}) \{
00288       QMessageBox::critical(\textcolor{keyword}{this}, \textcolor{stringliteral}{"Write to file failed"},
00289                             \textcolor{stringliteral}{"Cannot save project."}, QMessageBox::Ok);
00290       \textcolor{keywordflow}{return};
00291     \}
00292   \}
00293 
00294   \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{setAltered}(\textcolor{keyword}{false});
00295 \}
00296 
00297 \textcolor{comment}{/*******************************************************************************}
00298 \textcolor{comment}{ * Save project as action.}
00299 \textcolor{comment}{ ******************************************************************************/}
00300 \textcolor{keywordtype}{void} QuickFlow::on\_actionSave\_as\_triggered()
00301 \{
00302   \textcolor{comment}{// Get file location from user.}
00303   QFileDialog projectFile(\textcolor{keyword}{this});
00304   projectFile.setAcceptMode(QFileDialog::AcceptSave);
00305   projectFile.setNameFilter(tr(\textcolor{stringliteral}{"QkFlow Project (*.qkf)"}));
00306   projectFile.setDirectory(QStandardPaths::standardLocations(
00307                              QStandardPaths::HomeLocation)[0]);
00308 
00309   \textcolor{comment}{// Check if user has canceled the opening.}
00310   \textcolor{keywordflow}{if} (projectFile.exec() != QDialog::Accepted) \{
00311     \textcolor{keywordflow}{return};
00312   \}
00313 
00314   \textcolor{comment}{// Grab filename.}
00315   QString filePath = projectFile.selectedFiles()[0];
00316 
00317   \textcolor{comment}{// Try to save.}
00318   \textcolor{keywordflow}{if} (project->\hyperlink{class_project_ad32a31d548ad38f4cbbe0f95879a68e5}{saveAs}(filePath) != \textcolor{keyword}{true}) \{
00319     QMessageBox::critical(\textcolor{keyword}{this}, \textcolor{stringliteral}{"Write to file failed"},
00320                           \textcolor{stringliteral}{"Cannot save project."}, QMessageBox::Ok);
00321     \textcolor{keywordflow}{return};
00322   \}
00323 
00324   \textcolor{comment}{// Adjust Project settings.}
00325   project->\hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath} = filePath;
00326 
00327   \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{setAltered}(\textcolor{keyword}{false});
00328 \}
00329 
00330 \textcolor{comment}{/*******************************************************************************}
00331 \textcolor{comment}{* Close project action.}
00332 \textcolor{comment}{******************************************************************************/}
00333 \textcolor{keywordtype}{void} QuickFlow::on\_actionClose\_triggered()
00334 \{
00335   \textcolor{comment}{// Check if project is open}
00336   \textcolor{keywordflow}{if} (project == NULL) \{
00337     \textcolor{comment}{// Disable interface and return}
00338     noProjectInterface();
00339     \textcolor{keywordflow}{return};
00340   \}
00341 
00342   \textcolor{comment}{// A project is open. Check for alterations and try to save.}
00343   \textcolor{comment}{// Check whether it does need to save the project or not}
00344   \textcolor{keywordflow}{if} (altered\_) \{
00345     \textcolor{comment}{// Ask user to discard changes}
00346     \textcolor{keywordtype}{int} button = QMessageBox::question(
00347                    \textcolor{keyword}{this}, \textcolor{stringliteral}{"Save"}, \textcolor{stringliteral}{"There are unsaved changes, save it?"},
00348                    QMessageBox::Discard | QMessageBox::Cancel | QMessageBox::Save);
00349 
00350     \textcolor{comment}{// User wants to save}
00351     \textcolor{keywordflow}{if} (button == QMessageBox::Save) \{
00352       \textcolor{comment}{// Try to save}
00353       ui->actionSave->trigger();
00354 
00355       \textcolor{comment}{// Check if save is Ok}
00356       \textcolor{keywordflow}{if} (altered\_) \{
00357         \textcolor{comment}{// User canceled}
00358         \textcolor{keywordflow}{return};
00359       \}
00360     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (button == QMessageBox::Cancel) \{
00361       \textcolor{comment}{// User canceled}
00362       \textcolor{keywordflow}{return};
00363     \}
00364   \}
00365 
00366   \textcolor{comment}{// Disconnect signals.}
00367   \textcolor{comment}{//disconnectSignals();}
00368 
00369   \textcolor{comment}{//delete project->network;}
00370   \textcolor{keyword}{delete} project;
00371   project = NULL;
00372   altered\_ = \textcolor{keyword}{false};
00373   noProjectInterface();
00374 \}
00375 
00376 
00377 \textcolor{comment}{/*******************************************************************************}
00378 \textcolor{comment}{* Add network action.}
00379 \textcolor{comment}{******************************************************************************/}
00380 \textcolor{keywordtype}{void} QuickFlow::on\_actionAdd\_Network\_triggered()
00381 \{
00382 
00383 \}
00384 
00385 \textcolor{comment}{/*******************************************************************************}
00386 \textcolor{comment}{ * Add bar action.}
00387 \textcolor{comment}{ ******************************************************************************/}
00388 \textcolor{keywordtype}{void} QuickFlow::on\_actionAddBar\_triggered()
00389 \{
00390 \textcolor{comment}{//  BarProperties barProperties(this);}
00391 \textcolor{comment}{//  barProperties.setOptions(project, NULL);}
00392 
00393 \textcolor{comment}{//  if (barProperties.exec() == QDialog::Accepted) \{}
00394 \textcolor{comment}{//    setAltered(true);}
00395 \textcolor{comment}{//  \}}
00396 \}
00397 
00398 \textcolor{comment}{/*******************************************************************************}
00399 \textcolor{comment}{ * Add line action.}
00400 \textcolor{comment}{ ******************************************************************************/}
00401 \textcolor{keywordtype}{void} QuickFlow::on\_actionAddLine\_triggered()
00402 \{
00403 \textcolor{comment}{//  LineProperties lineProperties(this);}
00404 \textcolor{comment}{//  lineProperties.setOptions(project, NULL);}
00405 
00406 \textcolor{comment}{//  if (lineProperties.exec() == QDialog::Accepted) \{}
00407 \textcolor{comment}{//    setAltered(true);}
00408 \textcolor{comment}{//  \}}
00409 \}
00410 
00411 \textcolor{comment}{/*******************************************************************************}
00412 \textcolor{comment}{ * Import txt type 1 action.}
00413 \textcolor{comment}{ ******************************************************************************/}
00414 \textcolor{keywordtype}{void} QuickFlow::on\_action\_txt\_type\_1\_triggered()
00415 \{
00416 \textcolor{comment}{// Check if there is a project already opened.}
00417   \textcolor{keywordflow}{if} (project != NULL) \{
00418     \textcolor{comment}{// Close project.}
00419     ui->actionClose->trigger();
00420 
00421     \textcolor{comment}{// If close didnt succed, cancel import.}
00422     \textcolor{keywordflow}{if} (project != NULL) \textcolor{keywordflow}{return};
00423   \}
00424 
00425   \textcolor{comment}{// Get file location from user.}
00426   QFileDialog txtFile(\textcolor{keyword}{this});
00427   txtFile.setAcceptMode(QFileDialog::AcceptOpen);
00428   txtFile.setFileMode(QFileDialog::ExistingFile);
00429   txtFile.setNameFilter(tr(\textcolor{stringliteral}{"Text File Type 1(*.txt)"}));
00430   txtFile.setDirectory(QStandardPaths::standardLocations(
00431                          QStandardPaths::HomeLocation)[0]);
00432 
00433   \textcolor{comment}{// Check if user has canceled the opening.}
00434   \textcolor{keywordflow}{if} (txtFile.exec() != QDialog::Accepted) \{
00435     \textcolor{keywordflow}{return};
00436   \}
00437 
00438   \textcolor{comment}{// Grab filename.}
00439   QString fileName = txtFile.selectedFiles()[0];
00440 
00441   \textcolor{comment}{// Try to import.}
00442   project = \hyperlink{import_8cpp_a67dd59b2afe82bc7272ad6dfd3bed633}{importTxtType1}(fileName);
00443 
00444   \textcolor{keywordflow}{if}(project == NULL) \{
00445     noProjectInterface();
00446   \} \textcolor{keywordflow}{else} \{
00447     workInterface();
00448     \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{setAltered}(\textcolor{keyword}{true});
00449     \textcolor{comment}{//ui->systemView->addNetwork(project->network);}
00450     \textcolor{comment}{//connectSignals();}
00451     ui->systemView->zoomFit();
00452   \}
00453 \}
00454 
00455 \textcolor{comment}{/*******************************************************************************}
00456 \textcolor{comment}{ * Import txt type 2 action.}
00457 \textcolor{comment}{ ******************************************************************************/}
00458 \textcolor{keywordtype}{void} QuickFlow::on\_action\_txt\_type\_2\_triggered()
00459 \{
00460   \textcolor{comment}{// Check if there is a project already opened.}
00461   \textcolor{keywordflow}{if} (project != NULL) \{
00462     \textcolor{comment}{// Close project.}
00463     ui->actionClose->trigger();
00464 
00465     \textcolor{comment}{// If close didnt succed, cancel import.}
00466     \textcolor{keywordflow}{if} (project != NULL) \textcolor{keywordflow}{return};
00467   \}
00468 
00469   \textcolor{comment}{// Get file location from user.}
00470   QFileDialog txtFile(\textcolor{keyword}{this});
00471   txtFile.setAcceptMode(QFileDialog::AcceptOpen);
00472   txtFile.setFileMode(QFileDialog::ExistingFile);
00473   txtFile.setNameFilter(tr(\textcolor{stringliteral}{"Text File Type 2(*.txt)"}));
00474   txtFile.setDirectory(QStandardPaths::standardLocations(
00475                          QStandardPaths::HomeLocation)[0]);
00476 
00477   \textcolor{comment}{// Check if user has canceled the opening.}
00478   \textcolor{keywordflow}{if} (txtFile.exec() != QDialog::Accepted) \{
00479     \textcolor{keywordflow}{return};
00480   \}
00481 
00482   \textcolor{comment}{// Grab filename.}
00483   QString fileName = txtFile.selectedFiles()[0];
00484 
00485   \textcolor{comment}{// Try to import.}
00486   project = \hyperlink{import_8cpp_a05a39d4117f6721dc4bbdd7d45bcdd45}{importTxtType2}(fileName);
00487 
00488   \textcolor{keywordflow}{if}(project == NULL) \{
00489     noProjectInterface();
00490   \} \textcolor{keywordflow}{else} \{
00491     workInterface();
00492     \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{setAltered}(\textcolor{keyword}{true});
00493     \textcolor{comment}{//ui->systemView->addNetwork(project->network);}
00494     \textcolor{comment}{//connectSignals();}
00495     ui->systemView->zoomFit();
00496   \}
00497 \}
00498 
00499 \textcolor{comment}{/*******************************************************************************}
00500 \textcolor{comment}{ * Import txt type 3 action.}
00501 \textcolor{comment}{ ******************************************************************************/}
00502 \textcolor{keywordtype}{void} QuickFlow::on\_action\_txt\_type\_3\_triggered()
00503 \{
00504   \textcolor{comment}{// Check if there is a project already opened.}
00505   \textcolor{keywordflow}{if} (project != NULL) \{
00506     \textcolor{comment}{// Close project.}
00507     ui->actionClose->trigger();
00508 
00509     \textcolor{comment}{// If close didnt succed, cancel import.}
00510     \textcolor{keywordflow}{if} (project != NULL) \textcolor{keywordflow}{return};
00511   \}
00512 
00513   \textcolor{comment}{// Get file location from user.}
00514   QFileDialog txtFile(\textcolor{keyword}{this});
00515   txtFile.setAcceptMode(QFileDialog::AcceptOpen);
00516   txtFile.setFileMode(QFileDialog::ExistingFile);
00517   txtFile.setNameFilter(tr(\textcolor{stringliteral}{"Text File Type 2(*.txt)"}));
00518   txtFile.setDirectory(QStandardPaths::standardLocations(
00519                          QStandardPaths::HomeLocation)[0]);
00520 
00521   \textcolor{comment}{// Check if user has canceled the opening.}
00522   \textcolor{keywordflow}{if} (txtFile.exec() != QDialog::Accepted) \{
00523     \textcolor{keywordflow}{return};
00524   \}
00525 
00526   \textcolor{comment}{// Grab filename.}
00527   QString fileName = txtFile.selectedFiles()[0];
00528 
00529   \textcolor{comment}{// Try to import.}
00530   project = \hyperlink{import_8cpp_ac1810dcefba801e18ee9900ed6c0ff82}{importTxtType3}(fileName);
00531 
00532   \textcolor{keywordflow}{if}(project == NULL) \{
00533     noProjectInterface();
00534   \} \textcolor{keywordflow}{else} \{
00535     workInterface();
00536     \hyperlink{group___window_ga4b63ea5ca52a9eea14db0a22b5a133f8}{setAltered}(\textcolor{keyword}{true});
00537     \textcolor{comment}{//ui->systemView->addNetwork(project->network);}
00538     \textcolor{comment}{//connectSignals();}
00539     ui->systemView->zoomFit();
00540   \}
00541 \}
00542 
00543 \textcolor{comment}{/*******************************************************************************}
00544 \textcolor{comment}{ * Cespedes action.}
00545 \textcolor{comment}{ ******************************************************************************/}
00546 \textcolor{keywordtype}{void} QuickFlow::on\_actionCespedes\_triggered()
00547 \{
00548   \textcolor{keywordflow}{if}(ui->actionShirmoharmmadi->isChecked()) \{
00549     ui->actionShirmoharmmadi->setChecked(\textcolor{keyword}{false});
00550   \}
00551 \}
00552 
00553 \textcolor{comment}{/*******************************************************************************}
00554 \textcolor{comment}{ * Shirmoharmmadi action.}
00555 \textcolor{comment}{ ******************************************************************************/}
00556 \textcolor{keywordtype}{void} QuickFlow::on\_actionShirmoharmmadi\_triggered()
00557 \{
00558   \textcolor{keywordflow}{if}(ui->actionCespedes->isChecked()) \{
00559     ui->actionCespedes->setChecked(\textcolor{keyword}{false});
00560   \}
00561 \}
00562 
00563 \textcolor{comment}{/*******************************************************************************}
00564 \textcolor{comment}{ * Sugiyama graph algorithm action.}
00565 \textcolor{comment}{ ******************************************************************************/}
00566 \textcolor{keywordtype}{void} QuickFlow::on\_actionSugiyama\_triggered()
00567 \{
00568   \textcolor{comment}{//redrawGraph2(project->network);}
00569   ui->systemView->zoomFit();
00570 \}
00571 
00572 \textcolor{comment}{/*******************************************************************************}
00573 \textcolor{comment}{ * Sugiyama fast graph algorithm action.}
00574 \textcolor{comment}{ ******************************************************************************/}
00575 \textcolor{keywordtype}{void} QuickFlow::on\_actionSugiyama\_Fast\_triggered()
00576 \{
00577   \textcolor{comment}{//redrawGraph1(project->network);}
00578   ui->systemView->zoomFit();
00579 \}
00580 
00581 \textcolor{comment}{/*******************************************************************************}
00582 \textcolor{comment}{ *  Multi-level graph algorithm action.}
00583 \textcolor{comment}{ ******************************************************************************/}
00584 \textcolor{keywordtype}{void} QuickFlow::on\_actionMulti\_level\_triggered()
00585 \{
00586   \textcolor{comment}{//redrawGraph3(project->network);}
00587   ui->systemView->zoomFit();
00588 \}
00589 
00590 \textcolor{comment}{/*******************************************************************************}
00591 \textcolor{comment}{ * Search bar action.}
00592 \textcolor{comment}{ ******************************************************************************/}
00593 \textcolor{keywordtype}{void} QuickFlow::on\_actionSearch\_Bar\_triggered()
00594 \{
00595   \textcolor{keywordtype}{bool} ok;
00596   \textcolor{keywordtype}{int} barId = QInputDialog::getInt(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Search for bar"}), tr(\textcolor{stringliteral}{"Bad Id"}), 0, 0,
00597                                    1000000, 1, &ok);
00598 
00599   \textcolor{keywordflow}{if}(ok) \{
00600     \textcolor{comment}{//Bar *bar = project->network->getBarById(barId);}
00601 
00602     \textcolor{comment}{//if (bar != NULL) \{}
00603 \textcolor{comment}{//      ui->systemView->fitInView(bar->x() -100, bar->y() -100,}
00604 \textcolor{comment}{//                                bar->boundingRect().width() +100,}
00605 \textcolor{comment}{//                                bar->boundingRect().height() +100,}
00606 \textcolor{comment}{//                                Qt::IgnoreAspectRatio);}
00607 \textcolor{comment}{//    \}}
00608   \}
00609 \}
00610 
00611 \textcolor{comment}{/*******************************************************************************}
00612 \textcolor{comment}{ * Run action.}
00613 \textcolor{comment}{ ******************************************************************************/}
00614 \textcolor{keywordtype}{void} QuickFlow::on\_actionRun\_triggered()
00615 \{
00616 
00617 \}
00618 
00619 \textcolor{comment}{/*******************************************************************************}
00620 \textcolor{comment}{ * About action.}
00621 \textcolor{comment}{ ******************************************************************************/}
00622 \textcolor{keywordtype}{void} QuickFlow::on\_actionAbout\_triggered()
00623 \{
00624   \hyperlink{class_about}{About} about(\textcolor{keyword}{this});
00625   about.exec();
00626 \}
00627 
00628 \textcolor{comment}{/*******************************************************************************}
00629 \textcolor{comment}{ * Close event.}
00630 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{quickflow_8cpp_source_l00631}{}\hyperlink{group___window_gac8cc1bb329961a0781ffed7b6f2ab402}{00631} \textcolor{keywordtype}{void} \hyperlink{group___window_gac8cc1bb329961a0781ffed7b6f2ab402}{QuickFlow::closeEvent}(QCloseEvent *event)
00632 \{
00633   \textcolor{comment}{// Hook to application exit.}
00634   \textcolor{comment}{// Check for unsaved changes.}
00635   \textcolor{keywordflow}{if} (altered\_) \{
00636     \textcolor{comment}{// Try to close project, saving the changes.}
00637     ui->actionClose->trigger();
00638 
00639     \textcolor{comment}{// Check for a  cancel}
00640     \textcolor{keywordflow}{if} (altered\_) \{
00641       \textcolor{comment}{// User doesnt want to quit}
00642       \textcolor{keyword}{event}->ignore();
00643       \textcolor{keywordflow}{return};
00644     \}
00645   \}
00646 
00647   saveSettings();
00648   \textcolor{keyword}{event}->accept();
00649 \}
00650 
00651 \textcolor{comment}{/*******************************************************************************}
00652 \textcolor{comment}{ * Load application settings.}
00653 \textcolor{comment}{ ******************************************************************************/}
00654 \textcolor{keywordtype}{void} QuickFlow::loadSettings()
00655 \{
00656   \textcolor{comment}{// systemView background.}
00657   QBrush bkbrush;
00658   bkbrush.setColor(settings->value(\textcolor{stringliteral}{"systemView\_background"}).value<QColor>());
00659   bkbrush.setStyle(Qt::SolidPattern);
00660   ui->systemView->setBackgroundBrush(bkbrush);
00661 \}
00662 
00663 \textcolor{comment}{/*******************************************************************************}
00664 \textcolor{comment}{ * Save application settings.}
00665 \textcolor{comment}{ ******************************************************************************/}
00666 \textcolor{keywordtype}{void} QuickFlow::saveSettings()
00667 \{
00668   \textcolor{comment}{// systemView background.}
00669   settings->setValue(\textcolor{stringliteral}{"systemView\_background"}, ui->systemView->backgroundBrush());
00670 
00671   \textcolor{comment}{// Save settings.}
00672   settings->sync();
00673 \}
00674 
00675 \textcolor{comment}{/*******************************************************************************}
00676 \textcolor{comment}{ * Create application settings.}
00677 \textcolor{comment}{ ******************************************************************************/}
00678 \textcolor{keywordtype}{void} QuickFlow::createSettings()
00679 \{
00680   \textcolor{comment}{// Save version.}
00681   settings->setValue(\textcolor{stringliteral}{"version"}, \hyperlink{group___window_gabfc3b1280bdae9a9c046d56b1459ab99}{kVersion});
00682 
00683 \textcolor{comment}{//  systemView background.}
00684   QBrush bkbrush;
00685   bkbrush.setColor(Qt::white);
00686   bkbrush.setStyle(Qt::SolidPattern);
00687   ui->systemView->setBackgroundBrush(bkbrush);
00688 
00689   \textcolor{comment}{// Store settings.}
00690   saveSettings();
00691 \}
00692 
00693 \textcolor{comment}{/*******************************************************************************}
00694 \textcolor{comment}{ * Upgrade application settings.}
00695 \textcolor{comment}{ ******************************************************************************/}
00696 \textcolor{keywordtype}{void} QuickFlow::upgradeSettings()
00697 \{
00698   \textcolor{comment}{// Remove everything and create a default.}
00699   settings->clear();
00700   createSettings();
00701 \}
00702 
00703 \textcolor{comment}{/*******************************************************************************}
00704 \textcolor{comment}{ * No project interface.}
00705 \textcolor{comment}{ ******************************************************************************/}
00706 \textcolor{keywordtype}{void} QuickFlow::noProjectInterface()
00707 \{
00708   \textcolor{comment}{// Project actions.}
00709   ui->actionNew->setEnabled(\textcolor{keyword}{true});
00710   ui->actionOpen->setEnabled(\textcolor{keyword}{true});
00711   ui->actionSave->setEnabled(\textcolor{keyword}{false});
00712   ui->actionSave\_as->setEnabled(\textcolor{keyword}{false});
00713   ui->actionClose->setEnabled(\textcolor{keyword}{false});
00714   ui->actionSettings->setEnabled(\textcolor{keyword}{false});
00715 
00716   \textcolor{comment}{// Simulation actions.}
00717   ui->actionRun->setEnabled(\textcolor{keyword}{false});
00718   ui->actionExport->setEnabled(\textcolor{keyword}{false});
00719 
00720   \textcolor{comment}{// Zoom actions.}
00721   ui->actionZoomFit->setEnabled(\textcolor{keyword}{false});
00722   ui->actionZoomIn->setEnabled(\textcolor{keyword}{false});
00723   ui->actionZoomOut->setEnabled(\textcolor{keyword}{false});
00724 
00725   \textcolor{comment}{// Power network actions}
00726   ui->actionAdd\_Network->setEnabled(\textcolor{keyword}{false});
00727   ui->actionAddBar->setEnabled(\textcolor{keyword}{false});
00728   ui->actionAddLine->setEnabled(\textcolor{keyword}{false});
00729   ui->actionSearch\_Bar->setEnabled(\textcolor{keyword}{false});
00730 
00731   \textcolor{comment}{// Algorithms actions.}
00732   ui->actionShirmoharmmadi->setEnabled(\textcolor{keyword}{false});
00733   ui->actionCespedes->setEnabled(\textcolor{keyword}{false});
00734   ui->actionSugiyama->setEnabled(\textcolor{keyword}{false});
00735   ui->actionSugiyama\_Fast->setEnabled(\textcolor{keyword}{false});
00736   ui->actionMulti\_level->setEnabled(\textcolor{keyword}{false});
00737 
00738   \textcolor{comment}{// Disable viewer.}
00739   ui->systemView->setEnabled(\textcolor{keyword}{false});
00740 \}
00741 
00742 \textcolor{comment}{/*******************************************************************************}
00743 \textcolor{comment}{ * Work interface.}
00744 \textcolor{comment}{ ******************************************************************************/}
00745 \textcolor{keywordtype}{void} QuickFlow::workInterface()
00746 \{
00747   \textcolor{comment}{// Project actions.}
00748   ui->actionNew->setEnabled(\textcolor{keyword}{true});
00749   ui->actionOpen->setEnabled(\textcolor{keyword}{true});
00750   ui->actionSave->setEnabled(\textcolor{keyword}{false});
00751   ui->actionSave\_as->setEnabled(\textcolor{keyword}{true});
00752   ui->actionClose->setEnabled(\textcolor{keyword}{true});
00753   ui->actionSettings->setEnabled(\textcolor{keyword}{true});
00754 
00755   \textcolor{comment}{// Simulation actions.}
00756   ui->actionRun->setEnabled(\textcolor{keyword}{true});
00757   ui->actionExport->setEnabled(\textcolor{keyword}{true});
00758 
00759   \textcolor{comment}{// Zoom actions.}
00760   ui->actionZoomFit->setEnabled(\textcolor{keyword}{true});
00761   ui->actionZoomIn->setEnabled(\textcolor{keyword}{true});
00762   ui->actionZoomOut->setEnabled(\textcolor{keyword}{true});
00763 
00764   \textcolor{comment}{// Power network actions}
00765   ui->actionAddBar->setEnabled(\textcolor{keyword}{true});
00766   ui->actionAddLine->setEnabled(\textcolor{keyword}{true});
00767   ui->actionSearch\_Bar->setEnabled(\textcolor{keyword}{true});
00768 
00769   \textcolor{comment}{// Algorithms actions.}
00770   ui->actionShirmoharmmadi->setEnabled(\textcolor{keyword}{true});
00771   ui->actionCespedes->setEnabled(\textcolor{keyword}{true});
00772   ui->actionSugiyama->setEnabled(\textcolor{keyword}{true});
00773   ui->actionSugiyama\_Fast->setEnabled(\textcolor{keyword}{true});
00774   ui->actionMulti\_level->setEnabled(\textcolor{keyword}{true});
00775 
00776   \textcolor{comment}{// Enable viewer}
00777   ui->systemView->setEnabled(\textcolor{keyword}{true});
00778 \}
00779 
\end{DoxyCode}
