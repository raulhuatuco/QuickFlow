\hypertarget{shirmoharmnadi_8cpp_source}{}\subsection{shirmoharmnadi.\+cpp}
\label{shirmoharmnadi_8cpp_source}\index{shirmoharmnadi.\+cpp@{shirmoharmnadi.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{shirmoharmmadi_8h}{shirmoharmmadi.h}"}
00002 
00003 \textcolor{preprocessor}{#include <QList>}
00004 \textcolor{preprocessor}{#include <QElapsedTimer>}
00005 
00006 \textcolor{preprocessor}{#include "\hyperlink{radiallayer_8h}{radiallayer.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{bar_8h}{models/bar.h}"}
00008 \textcolor{preprocessor}{#include "\hyperlink{line_8h}{models/line.h}"}
00009 
\hypertarget{shirmoharmnadi_8cpp_source_l00010}{}\hyperlink{class_shirmoharmmadi_aa5833386f9b43019a318c81a3006e2b1}{00010} \hyperlink{class_shirmoharmmadi_aa5833386f9b43019a318c81a3006e2b1}{Shirmoharmmadi::Shirmoharmmadi}(\hyperlink{class_network}{Network} *network) :
00011   network\_(network)
00012 \{
00013 
00014 \}
00015 
\hypertarget{shirmoharmnadi_8cpp_source_l00016}{}\hyperlink{class_shirmoharmmadi_ac89016d70d3c99339af11f3b6f1f23b2}{00016} \hyperlink{class_shirmoharmmadi_ac89016d70d3c99339af11f3b6f1f23b2}{Shirmoharmmadi::~Shirmoharmmadi}()
00017 \{
00018 
00019 \}
00020 
\hypertarget{shirmoharmnadi_8cpp_source_l00021}{}\hyperlink{class_shirmoharmmadi_acb4a06c62b5d97c25bea70acd477e715}{00021} \textcolor{keywordtype}{bool} \hyperlink{class_shirmoharmmadi_acb4a06c62b5d97c25bea70acd477e715}{Shirmoharmmadi::solve}()
00022 \{
00023   QElapsedTimer timer;
00024   timer.start();
00025 
00026   \hyperlink{class_radial_layer}{RadialLayer} radLayer(network\_);
00027 
00028   radLayer.\hyperlink{class_radial_layer_a971680f24ba6c516afedbc49d8c22cab}{calculate}();
00029 
00030   uint32\_t iteration = 0;
00031 
00032   \textcolor{keywordflow}{foreach}(\hyperlink{class_bar}{Bar} *bar, network\_->\hyperlink{class_network_a7fe628f7de34a96235cbd3f2cee4aff2}{bars}) \{
00033     bar->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(0, bar->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(0));
00034     bar->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(1, bar->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(1));
00035     bar->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(2, bar->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(2));
00036   \}
00037 
00038   QList<Line *> processedLines;
00039   \textcolor{keywordtype}{double} maxError;
00040 
00041   \textcolor{keywordflow}{do} \{
00042 
00043     \textcolor{comment}{//Backward sweep.}
00044     \textcolor{comment}{// Calculate line current.}
00045     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = radLayer.\hyperlink{class_radial_layer_ae8b32d0711cc6f4dbec832bb07d59a49}{width}() -1; i>0; i--) \{
00046 
00047       \textcolor{comment}{// Process every bar in the layer.}
00048       \textcolor{keywordflow}{foreach}(\hyperlink{class_bar}{Bar} *bar, *radLayer.\hyperlink{class_radial_layer_a714c36b1ab50a7778953e924ddac2787}{layers}.at(i)) \{
00049 
00050         \textcolor{comment}{// Process every line of the bar.}
00051         \textcolor{keywordflow}{foreach}(\hyperlink{class_line}{Line} *line, bar->\hyperlink{class_bar_a23b6d4319352ef0e77ad66aade4e0209}{lines}) \{
00052 
00053           \textcolor{comment}{// Check if line already have I.}
00054           \textcolor{keywordflow}{if}(processedLines.indexOf(line) == -1) \{
00055 
00056             \textcolor{comment}{// If not, sum every other lines I.}
00057             complex<double> iLine[3];
00058 
00059             \textcolor{keywordflow}{foreach}(\hyperlink{class_line}{Line} *oline, bar->\hyperlink{class_bar_a23b6d4319352ef0e77ad66aade4e0209}{lines}) \{
00060               \textcolor{keywordflow}{if}(oline != line) \{
00061                 iLine[0] += oline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(0, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00062                 iLine[1] += oline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(1, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00063                 iLine[2] += oline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(2, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00064               \}
00065             \}
00066 
00067             \textcolor{comment}{// Remove Bar I.}
00068             iLine[0] -= bar->\hyperlink{group___models_ga8a009531f01430aa68eba739bb0dc2ea}{rI}(0, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00069             iLine[1] -= bar->\hyperlink{group___models_ga8a009531f01430aa68eba739bb0dc2ea}{rI}(1, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00070             iLine[2] -= bar->\hyperlink{group___models_ga8a009531f01430aa68eba739bb0dc2ea}{rI}(2, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00071 
00072             \textcolor{comment}{// Set line current.}
00073             line->\hyperlink{group___models_ga9e55b06dc3e385838fdd13d5580438ef}{setI}(0, iLine[0], \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00074             line->\hyperlink{group___models_ga9e55b06dc3e385838fdd13d5580438ef}{setI}(1, iLine[1], \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00075             line->\hyperlink{group___models_ga9e55b06dc3e385838fdd13d5580438ef}{setI}(2, iLine[2], \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00076             processedLines.append(line);
00077           \}
00078         \}
00079       \}
00080     \}
00081 
00082     processedLines.clear();
00083 
00084     \textcolor{comment}{// Forward sweep.}
00085     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0; i<radLayer.\hyperlink{class_radial_layer_ae8b32d0711cc6f4dbec832bb07d59a49}{width}() -1; i++) \{
00086 
00087       \textcolor{comment}{// Go trough every bar.}
00088       \textcolor{keywordflow}{foreach}(\hyperlink{class_bar}{Bar} *bar, *radLayer.\hyperlink{class_radial_layer_a714c36b1ab50a7778953e924ddac2787}{layers}[i]) \{
00089 
00090         \textcolor{comment}{// Process every line of the bar.}
00091         \textcolor{keywordflow}{foreach}(\hyperlink{class_line}{Line} *line, bar->\hyperlink{class_bar_a23b6d4319352ef0e77ad66aade4e0209}{lines}) \{
00092 
00093           \textcolor{comment}{// Check if line has been processed.}
00094           \textcolor{keywordflow}{if}(processedLines.indexOf(line) == -1) \{
00095 
00096             complex<double> bVoltage[3];
00097             bVoltage[0] = bar->\hyperlink{group___models_ga2d1f6bfbd8abaf168bb75bd8e5cd9b5e}{rV}(0,\hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00098             bVoltage[1] = bar->\hyperlink{group___models_ga2d1f6bfbd8abaf168bb75bd8e5cd9b5e}{rV}(1,\hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00099             bVoltage[2] = bar->\hyperlink{group___models_ga2d1f6bfbd8abaf168bb75bd8e5cd9b5e}{rV}(2,\hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00100 
00101             bVoltage[0] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(0, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(0,\hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00102             bVoltage[0] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(1, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(1, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00103             bVoltage[0] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(2,\hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(2, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00104 
00105             bVoltage[1] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(1, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(0,\hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00106             bVoltage[1] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(3, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(1, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00107             bVoltage[1] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(4,\hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(2, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00108 
00109             bVoltage[2] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(2, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(0,\hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00110             bVoltage[2] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(4, \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(1, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00111             bVoltage[2] += line->\hyperlink{group___models_gab5370574fd93e13eb11742f7753fe1f1}{z}(5,\hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa9327dc8628a47375d70037499f9d0910}{Unit::kOhmPerUnit})*line->
      \hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(2, \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit});
00112 
00113             line->\hyperlink{group___models_gabbc73ddedd3075c33ae5331bd7c9829f}{pNoF}()->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(0, bVoltage[0], \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00114             line->\hyperlink{group___models_gabbc73ddedd3075c33ae5331bd7c9829f}{pNoF}()->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(1, bVoltage[1], \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00115             line->\hyperlink{group___models_gabbc73ddedd3075c33ae5331bd7c9829f}{pNoF}()->\hyperlink{group___models_ga2b2c5a373d87025e79d26aa9c4cea75a}{setRV}(2, bVoltage[2], \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit});
00116 
00117             processedLines.append(line);
00118           \}
00119         \}
00120       \}
00121     \}
00122 
00123 \textcolor{comment}{// Calculate Slack current.}
00124     \hyperlink{class_bar}{Bar} *slack = network\_->\hyperlink{group___graphics_ga04d524ce0fa0dd0d06deda92b1597af0}{getBarById}(0);
00125 
00126     complex<double> iSlack[3];
00127 
00128     \textcolor{keywordflow}{foreach}(\hyperlink{class_line}{Line} *sline, slack->\hyperlink{class_bar_a23b6d4319352ef0e77ad66aade4e0209}{lines}) \{
00129       iSlack[0] += sline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(0);
00130       iSlack[1] += sline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(1);
00131       iSlack[2] += sline->\hyperlink{group___models_gaf81e7055102816465bdf7e19afc2d547}{i}(2);
00132     \}
00133 
00134     complex<double> siSlack[3];
00135     siSlack[0] = sqrt(3)*slack->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(0)*iSlack[0];
00136     siSlack[1] = sqrt(3)*slack->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(1)*iSlack[1];
00137     siSlack[2] = sqrt(3)*slack->\hyperlink{group___models_ga1e6f2daec86407118656d88170d1adc2}{v}(2)*iSlack[2];
00138 
00139     slack->\hyperlink{group___models_ga74e510be49e50e4c14550b32e1dc92f9}{setSi}(0, siSlack[0]);
00140     slack->\hyperlink{group___models_ga74e510be49e50e4c14550b32e1dc92f9}{setSi}(1, siSlack[2]);
00141     slack->\hyperlink{group___models_ga74e510be49e50e4c14550b32e1dc92f9}{setSi}(2, siSlack[1]);
00142     \textcolor{comment}{// Compute max error.}
00143     complex<double> error[3];
00144     maxError = -qInf();
00145 
00146     \textcolor{keywordflow}{foreach}(\hyperlink{class_bar}{Bar} *bar, network\_->\hyperlink{class_network_a7fe628f7de34a96235cbd3f2cee4aff2}{bars}) \{
00147 
00148       error[0] = bar->\hyperlink{group___models_ga2d1f6bfbd8abaf168bb75bd8e5cd9b5e}{rV}(0, \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1ab44b1310b59fdcdc9df5bbea91da4206}{Unit::kVoltsPerUnit})*conj(bar->
      \hyperlink{group___models_ga8a009531f01430aa68eba739bb0dc2ea}{rI}(0,
00149                  \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787aeed3b50e464d581cb630181a3b6a0709}{Unit::kAmperePerUnit}));
00150 
00151       error[0] -= bar->\hyperlink{group___models_gac188071bf5f165b0acdaa4c8af82355c}{sh}(0, \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bae056e80d620a87c61a44c359e6b05cc1}{Unit::kVaPerUnit});
00152 
00153       error[0] -= bar->\hyperlink{group___models_ga02bbc279f1e133f66b12ee21e7bebcd8}{si}(0, \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bae056e80d620a87c61a44c359e6b05cc1}{Unit::kVaPerUnit});
00154 
00155       \textcolor{keywordflow}{if}(abs(error[0].real())>maxError)
00156         maxError = error[0].real();
00157 
00158       \textcolor{keywordflow}{if}(abs(error[0].imag()) >maxError)
00159         maxError = error[0].imag();
00160     \}
00161 
00162     iteration++;
00163   \} \textcolor{keywordflow}{while}(( maxError > network\_->\hyperlink{group___graphics_gabcdc973129d3dda7572b7a1c388da1b5}{minError}) &&
00164           (iteration < network\_->maxIterations));
00165 
00166   \hyperlink{class_shirmoharmmadi_a32ab19ff485833106bf68cd91dbc94e6}{duration} = timer.elapsed();
00167   \hyperlink{class_shirmoharmmadi_afdd22da0145b033c47f4f8a6bbd37d0d}{usedIterations} = iteration;
00168 
00169   \textcolor{keywordflow}{if} (iteration < network\_->maxIterations)
00170     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00171   \textcolor{keywordflow}{else}
00172     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00173 \}
00174 
\end{DoxyCode}
