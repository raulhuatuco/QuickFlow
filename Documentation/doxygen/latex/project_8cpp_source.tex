\hypertarget{project_8cpp_source}{}\subsection{project.\+cpp}
\label{project_8cpp_source}\index{project.\+cpp@{project.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{project_8h}{project.h}"}
00002 \textcolor{preprocessor}{#include <QFile>}
00003 \textcolor{preprocessor}{#include <QDir>}
00004 \textcolor{preprocessor}{#include <QJsonDocument>}
00005 \textcolor{preprocessor}{#include <QJsonArray>}
00006 \textcolor{preprocessor}{#include "\hyperlink{bar_8h}{models/bar.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{line_8h}{models/line.h}"}
00008 
00009 \textcolor{comment}{/*******************************************************************************}
00010 \textcolor{comment}{ * Constructor.}
00011 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00012}{}\hyperlink{class_project_aa007ecd17d5bc800e7a956cf666eea21}{00012} \hyperlink{class_project_aa007ecd17d5bc800e7a956cf666eea21}{Project::Project}()
00013 \{
00014 \}
00015 
00016 \textcolor{comment}{/*******************************************************************************}
00017 \textcolor{comment}{ * Destructor.}
00018 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00019}{}\hyperlink{class_project_ad165d61b76ee86ee9c27fd987a2a7b9e}{00019} \hyperlink{class_project_ad165d61b76ee86ee9c27fd987a2a7b9e}{Project::~Project}()
00020 \{
00021   \textcolor{keywordflow}{foreach}(\hyperlink{class_network}{Network} *network, \hyperlink{class_project_aa98126154cab59769a431668e6f17daf}{networks}) \{
00022     \textcolor{keyword}{delete} network;
00023   \}
00024 \}
00025 
00026 \textcolor{comment}{/*******************************************************************************}
00027 \textcolor{comment}{ * maxIterations.}
00028 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00029}{}\hyperlink{class_project_ab9d6426396a75f2fcaeadcddcd0fac64}{00029} uint32\_t \hyperlink{class_project_ab9d6426396a75f2fcaeadcddcd0fac64}{Project::maxIterations}()
00030 \{
00031   \textcolor{keywordflow}{return} \hyperlink{group___models_ga318dee060bc577eacd67d332efbbe1b2}{Network::maxIterations};
00032 \}
00033 
00034 \textcolor{comment}{/*******************************************************************************}
00035 \textcolor{comment}{ * setMaxIterations.}
00036 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00037}{}\hyperlink{class_project_af2046a5d542d3e3dd51cb9cb04604e8f}{00037} \textcolor{keywordtype}{void} \hyperlink{class_project_af2046a5d542d3e3dd51cb9cb04604e8f}{Project::setMaxIterations}(uint32\_t maxIterations)
00038 \{
00039   \hyperlink{group___models_ga318dee060bc577eacd67d332efbbe1b2}{Network::maxIterations} = \hyperlink{class_project_ab9d6426396a75f2fcaeadcddcd0fac64}{maxIterations};
00040 \}
00041 
00042 \textcolor{comment}{/*******************************************************************************}
00043 \textcolor{comment}{ * minError.}
00044 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00045}{}\hyperlink{class_project_a457ed8d3b0ea5816f928977509f69a34}{00045} \textcolor{keywordtype}{double} \hyperlink{class_project_a457ed8d3b0ea5816f928977509f69a34}{Project::minError}()
00046 \{
00047   \textcolor{keywordflow}{return} \hyperlink{group___models_gabcdc973129d3dda7572b7a1c388da1b5}{Network::minError};
00048 \}
00049 
00050 \textcolor{comment}{/*******************************************************************************}
00051 \textcolor{comment}{ * setMinError.}
00052 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00053}{}\hyperlink{class_project_a2cb776c39adb42a1113bf7887d0d4636}{00053} \textcolor{keywordtype}{void} \hyperlink{class_project_a2cb776c39adb42a1113bf7887d0d4636}{Project::setMinError}(\textcolor{keywordtype}{double} minError)
00054 \{
00055   \hyperlink{group___models_gabcdc973129d3dda7572b7a1c388da1b5}{Network::minError} = \hyperlink{class_project_a457ed8d3b0ea5816f928977509f69a34}{minError};
00056 \}
00057 
00058 \textcolor{comment}{/*******************************************************************************}
00059 \textcolor{comment}{ * lengthUn.}
00060 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00061}{}\hyperlink{class_project_a40cd2f59a4a708897e5997942c046f4d}{00061} \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit} \hyperlink{class_project_a40cd2f59a4a708897e5997942c046f4d}{Project::lengthUnit}()
00062 \{
00063   \textcolor{keywordflow}{return} \hyperlink{group___models_gae46c0e2bf39b343875e3c69066fe2652}{Network::lengthUnit};
00064 \}
00065 
00066 \textcolor{comment}{/*******************************************************************************}
00067 \textcolor{comment}{ * setLengthUn.}
00068 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00069}{}\hyperlink{class_project_a846ee2284b0856d461b35d78d9f8e1d6}{00069} \textcolor{keywordtype}{void} \hyperlink{class_project_a846ee2284b0856d461b35d78d9f8e1d6}{Project::setLengthUn}(\hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit} lengthUn)
00070 \{
00071   \hyperlink{group___models_gae46c0e2bf39b343875e3c69066fe2652}{Network::lengthUnit} = lengthUn;
00072 \}
00073 
00074 \textcolor{comment}{/*******************************************************************************}
00075 \textcolor{comment}{ * impedanceUn.}
00076 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00077}{}\hyperlink{class_project_ad0725b9aa4445dd6d21d4e15df482d3b}{00077} \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit} \hyperlink{class_project_ad0725b9aa4445dd6d21d4e15df482d3b}{Project::impedanceUnit}()
00078 \{
00079   \textcolor{keywordflow}{return} \hyperlink{group___models_ga5f3d72699a723c64a89d22e34df708ff}{Network::impedanceUnit};
00080 \}
00081 
00082 \textcolor{comment}{/*******************************************************************************}
00083 \textcolor{comment}{ * setImpedanceUn.}
00084 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00085}{}\hyperlink{class_project_a995d050781923522ae2a02728346d199}{00085} \textcolor{keywordtype}{void} \hyperlink{class_project_a995d050781923522ae2a02728346d199}{Project::setImpedanceUn}(\hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit} impedanceUn)
00086 \{
00087   \hyperlink{group___models_ga5f3d72699a723c64a89d22e34df708ff}{Network::impedanceUnit} = impedanceUn;
00088 \}
00089 
00090 \textcolor{comment}{/*******************************************************************************}
00091 \textcolor{comment}{ * voltageUn.}
00092 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00093}{}\hyperlink{class_project_a93b928093072ba15c24693b03a934e4e}{00093} \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1}{Unit::VoltageUnit} \hyperlink{class_project_a93b928093072ba15c24693b03a934e4e}{Project::voltageUnit}()
00094 \{
00095   \textcolor{keywordflow}{return} \hyperlink{group___models_gacde031ef95f5c05565ee35769f2ed89e}{Network::voltageUnit};
00096 \}
00097 
00098 \textcolor{comment}{/*******************************************************************************}
00099 \textcolor{comment}{ * setVoltageUn.}
00100 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00101}{}\hyperlink{class_project_aa26b488b2e93c8a8c6b4423ce07df4a1}{00101} \textcolor{keywordtype}{void} \hyperlink{class_project_aa26b488b2e93c8a8c6b4423ce07df4a1}{Project::setVoltageUn}(\hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1}{Unit::VoltageUnit} voltageUn)
00102 \{
00103   \hyperlink{group___models_gacde031ef95f5c05565ee35769f2ed89e}{Network::voltageUnit} = voltageUn;
00104 \}
00105 
00106 \textcolor{comment}{/*******************************************************************************}
00107 \textcolor{comment}{ * powerUn.}
00108 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00109}{}\hyperlink{class_project_a2a1bc35358d6189695d6e5b7dd547ffd}{00109} \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit} \hyperlink{class_project_a2a1bc35358d6189695d6e5b7dd547ffd}{Project::powerUnit}()
00110 \{
00111   \textcolor{keywordflow}{return} \hyperlink{group___models_ga9504015bc566f4a3d3b4d4a86000293b}{Network::powerUnit};
00112 \}
00113 
00114 \textcolor{comment}{/*******************************************************************************}
00115 \textcolor{comment}{ * setPowerUn.}
00116 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00117}{}\hyperlink{class_project_aa46b8645d2047c1a2e8d329b9ebbc120}{00117} \textcolor{keywordtype}{void} \hyperlink{class_project_aa46b8645d2047c1a2e8d329b9ebbc120}{Project::setPowerUn}(\hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit} powerUn)
00118 \{
00119   \hyperlink{group___models_ga9504015bc566f4a3d3b4d4a86000293b}{Network::powerUnit} = powerUn;
00120 \}
00121 
00122 \textcolor{comment}{/*******************************************************************************}
00123 \textcolor{comment}{ * currentUnit.}
00124 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00125}{}\hyperlink{class_project_a0d22341fcc068be743b776df0a02f55e}{00125} \hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787}{Unit::CurrentUnit} \hyperlink{class_project_a0d22341fcc068be743b776df0a02f55e}{Project::currentUnit}()
00126 \{
00127   \textcolor{keywordflow}{return} \hyperlink{group___models_gac6a26db5fef2b1dd2a00faf6340d1702}{Network::currentUnit};
00128 \}
00129 
00130 \textcolor{comment}{/*******************************************************************************}
00131 \textcolor{comment}{ * setCurrentUnit.}
00132 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00133}{}\hyperlink{class_project_a64d9800bc3acafcfa4d3f45ee5aacc6d}{00133} \textcolor{keywordtype}{void} \hyperlink{class_project_a64d9800bc3acafcfa4d3f45ee5aacc6d}{Project::setCurrentUnit}(\hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787}{Unit::CurrentUnit} unit)
00134 \{
00135   \hyperlink{group___models_gac6a26db5fef2b1dd2a00faf6340d1702}{Network::currentUnit} = unit;
00136 \}
00137 
00138 \textcolor{comment}{/*******************************************************************************}
00139 \textcolor{comment}{ * save.}
00140 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00141}{}\hyperlink{class_project_a596a875bc5be73bc5b1b71b6448c1e07}{00141} \textcolor{keywordtype}{bool} \hyperlink{class_project_a596a875bc5be73bc5b1b71b6448c1e07}{Project::save}()
00142 \{
00143   \textcolor{comment}{// Try to open file.}
00144   QFile file;
00145   file.setFileName(\hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath});
00146 
00147   \textcolor{comment}{// Check for write permission.}
00148   \textcolor{keywordflow}{if} (!file.open(QIODevice::WriteOnly))
00149     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00150 
00151   \textcolor{comment}{// Create Json Configuration.}
00152   QJsonObject projectJson;
00153 
00154   \textcolor{comment}{// Add project settings.}
00155   projectJson.insert(\textcolor{stringliteral}{"name"}, \hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name});
00156 
00157   \textcolor{comment}{// Add network settings.}
00158   projectJson.insert(\textcolor{stringliteral}{"maxIterations"},
00159                      static\_cast<int32\_t> (\hyperlink{group___models_ga318dee060bc577eacd67d332efbbe1b2}{Network::maxIterations}));
00160   projectJson.insert(\textcolor{stringliteral}{"minError"}, \hyperlink{group___models_gabcdc973129d3dda7572b7a1c388da1b5}{Network::minError});
00161   projectJson.insert(\textcolor{stringliteral}{"lengthUnit"}, \hyperlink{group___models_gae46c0e2bf39b343875e3c69066fe2652}{Network::lengthUnit});
00162   projectJson.insert(\textcolor{stringliteral}{"impedanceUnit"}, \hyperlink{group___models_ga5f3d72699a723c64a89d22e34df708ff}{Network::impedanceUnit});
00163   projectJson.insert(\textcolor{stringliteral}{"voltageUnit"}, \hyperlink{group___models_gacde031ef95f5c05565ee35769f2ed89e}{Network::voltageUnit});
00164   projectJson.insert(\textcolor{stringliteral}{"powerUnit"}, \hyperlink{group___models_ga9504015bc566f4a3d3b4d4a86000293b}{Network::powerUnit});
00165   projectJson.insert(\textcolor{stringliteral}{"currentUnit"}, \hyperlink{group___models_gac6a26db5fef2b1dd2a00faf6340d1702}{Network::currentUnit});
00166 
00167   \textcolor{comment}{// Creates a QJsonArray filled with networks data.}
00168   QJsonArray networkArray;
00169   \textcolor{keywordflow}{foreach} (\hyperlink{class_network}{Network} *network, \hyperlink{class_project_aa98126154cab59769a431668e6f17daf}{networks}) \{
00170     networkArray << network->\hyperlink{group___models_ga1bb9773d3935eefef84136d388786494}{toJson}();
00171   \}
00172   projectJson.insert(\textcolor{stringliteral}{"networkArray"}, networkArray);
00173 
00174   \textcolor{comment}{// Create a Json document to conver Json data to text.}
00175   QJsonDocument jsonDoc(projectJson);
00176 
00177   \textcolor{comment}{// Write to file.}
00178   qint64 err = file.write(jsonDoc.toJson());
00179   file.close();
00180 
00181   \textcolor{keywordflow}{return} (err > -1) ? \textcolor{keyword}{true} : \textcolor{keyword}{false};
00182 \}
00183 
00184 \textcolor{comment}{/*******************************************************************************}
00185 \textcolor{comment}{ * saveAs.}
00186 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00187}{}\hyperlink{class_project_ad32a31d548ad38f4cbbe0f95879a68e5}{00187} \textcolor{keywordtype}{bool} \hyperlink{class_project_ad32a31d548ad38f4cbbe0f95879a68e5}{Project::saveAs}(QString fileName)
00188 \{
00189   \textcolor{comment}{// Save old path.}
00190   QString oldpath;
00191   oldpath = \hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath};
00192 
00193   \textcolor{comment}{// Set new path.}
00194   \hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath} = fileName;
00195 
00196   \textcolor{comment}{// try to save.}
00197   \textcolor{keywordflow}{if}(!\hyperlink{class_project_a596a875bc5be73bc5b1b71b6448c1e07}{save}()) \{
00198     \textcolor{comment}{// Failed to save. Return to old path.}
00199     \hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath} = oldpath;
00200     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00201   \}
00202 
00203   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00204 \}
00205 
00206 \textcolor{comment}{/*******************************************************************************}
00207 \textcolor{comment}{ * load.}
00208 \textcolor{comment}{ ******************************************************************************/}
\hypertarget{project_8cpp_source_l00209}{}\hyperlink{class_project_a1e373892a0383371132ce68fa5f8813d}{00209} \textcolor{keywordtype}{bool} \hyperlink{class_project_a1e373892a0383371132ce68fa5f8813d}{Project::load}()
00210 \{
00211   \textcolor{comment}{// Try to open file.}
00212   QFile file;
00213   file.setFileName(\hyperlink{class_project_a79f30adcefd0b72bd4ac7db724bc9531}{filePath});
00214 
00215   \textcolor{comment}{// Check for read permission.}
00216   \textcolor{keywordflow}{if} (!file.open(QIODevice::ReadOnly))
00217     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00218 
00219   \textcolor{comment}{// Create Doc to transform text to json.}
00220   QJsonDocument jsonDoc = QJsonDocument::fromJson(file.readAll());
00221 
00222   \textcolor{comment}{// Chech if file is valid.}
00223   \textcolor{keywordflow}{if} (jsonDoc.isNull() || !jsonDoc.isObject())
00224     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00225 
00226   \textcolor{comment}{// Fill base Json object.}
00227   QJsonObject projectJson;
00228   projectJson = jsonDoc.object();
00229 
00230   \textcolor{comment}{// Extract project info.}
00231   \hyperlink{class_project_a82dd2d1bc38f9fd08c9a811fcaa76b38}{name} = projectJson.value(\textcolor{stringliteral}{"name"}).toString();
00232 
00233   \textcolor{comment}{// Extract network info.}
00234   \hyperlink{group___models_ga318dee060bc577eacd67d332efbbe1b2}{Network::maxIterations} = projectJson.value(\textcolor{stringliteral}{"maxIterations"}).toDouble();
00235   \hyperlink{group___models_gabcdc973129d3dda7572b7a1c388da1b5}{Network::minError} = projectJson.value(\textcolor{stringliteral}{"minError"}).toDouble();
00236   \hyperlink{group___models_gae46c0e2bf39b343875e3c69066fe2652}{Network::lengthUnit} =
00237     \textcolor{keyword}{static\_cast<}\hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit}\textcolor{keyword}{>} (projectJson.value(\textcolor{stringliteral}{"lengthUnit"}).toInt());
00238   \hyperlink{group___models_ga5f3d72699a723c64a89d22e34df708ff}{Network::impedanceUnit} =
00239     \textcolor{keyword}{static\_cast<}\hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit}\textcolor{keyword}{>} (projectJson.value(\textcolor{stringliteral}{"impedanceUnit"}).toInt());
00240   \hyperlink{group___models_gacde031ef95f5c05565ee35769f2ed89e}{Network::voltageUnit} =
00241     \textcolor{keyword}{static\_cast<}\hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1}{Unit::VoltageUnit}\textcolor{keyword}{>} (projectJson.value(\textcolor{stringliteral}{"voltageUnit"}).toInt());
00242   \hyperlink{group___models_ga9504015bc566f4a3d3b4d4a86000293b}{Network::powerUnit} =
00243     \textcolor{keyword}{static\_cast<}\hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit}\textcolor{keyword}{>} (projectJson.value(\textcolor{stringliteral}{"powerUnit"}).toInt());
00244   \hyperlink{group___models_gac6a26db5fef2b1dd2a00faf6340d1702}{Network::currentUnit} =
00245     \textcolor{keyword}{static\_cast<}\hyperlink{class_unit_a0794cf6c9682f48296dd4a5315389787}{Unit::CurrentUnit}\textcolor{keyword}{>} (projectJson.value(\textcolor{stringliteral}{"currentUnit"}).toInt());
00246 
00247   \textcolor{comment}{// Extract network data from a QJsonArray.}
00248   QJsonArray networkArray(projectJson.value(\textcolor{stringliteral}{"networkArray"}).toArray());
00249 
00250   \textcolor{keywordflow}{foreach} (QJsonValue arrayValue, networkArray) \{
00251     QJsonObject networkJson(arrayValue.toObject());
00252 
00253     \hyperlink{class_network}{Network} *network = \textcolor{keyword}{new} \hyperlink{class_network}{Network};
00254     network->\hyperlink{group___models_ga2aef0f6c0d9569ec4d6b948d1ef0d5f1}{fromJson}(networkJson);
00255     \hyperlink{class_project_aa98126154cab59769a431668e6f17daf}{networks}.insert(network->name, network);
00256   \}
00257 
00258 \textcolor{comment}{// Close file}
00259   file.close();
00260 
00261   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00262 \}
00263 
00264 
\end{DoxyCode}
