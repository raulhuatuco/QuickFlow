\hypertarget{import_8cpp_source}{}\subsection{import.\+cpp}
\label{import_8cpp_source}\index{import.\+cpp@{import.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{import_8h}{algorithms/import.h}"}
00002 \textcolor{preprocessor}{#include <QtGui>}
00003 \textcolor{preprocessor}{#include <QtCore>}
00004 \textcolor{preprocessor}{#include <QtWidgets>}
00005 \textcolor{preprocessor}{#include "\hyperlink{network_8h}{models/network.h}"}
00006 \textcolor{preprocessor}{#include "\hyperlink{redrawnetwork_8h}{algorithms/redrawnetwork.h}"}
00007 \textcolor{preprocessor}{#include "\hyperlink{math__constants_8h}{math\_constants.h}"}
00008 
00009 \textcolor{keyword}{static} int32\_t getNextLineInt(QTextStream *stream, QString keyWord,
00010                               int32\_t *intVal)
00011 \{
00012   QString lineTxt; \textcolor{comment}{// Line text.}
00013   int32\_t lineCnt = 0; \textcolor{comment}{// Count the amount of processed lines.}
00014 
00015   \textcolor{comment}{// Loop until keyWord is found or EoF.}
00016   \textcolor{keywordflow}{do} \{
00017     \textcolor{keywordflow}{if}(stream->atEnd())
00018       \textcolor{keywordflow}{return} -1;
00019 
00020     lineTxt = stream->readLine();
00021     lineCnt++;
00022   \} \textcolor{keywordflow}{while}(!lineTxt.contains(keyWord));
00023 
00024   \textcolor{comment}{// Get integer value.}
00025   *stream >> *intVal;
00026   \textcolor{keywordflow}{return} lineCnt;
00027 \}
00028 
\hypertarget{import_8cpp_source_l00029}{}\hyperlink{import_8h_ab30ac380d5e14f830ebc8eb839fbbdf0}{00029} \textcolor{keywordtype}{bool} \hyperlink{import_8cpp_ab30ac380d5e14f830ebc8eb839fbbdf0}{importTxtType1}(QString &fileName, \hyperlink{class_network}{Network} *network)
00030 \{
00031   \textcolor{comment}{// Create project with file settings.}
00032   QFile file(fileName);
00033 
00034   \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly)) \{
00035     QMessageBox::critical(NULL, \textcolor{stringliteral}{"File read error."},
00036                           \textcolor{stringliteral}{"Can\(\backslash\)'t read "} + file.fileName() + \textcolor{stringliteral}{"."},
00037                           QMessageBox::Ok);
00038     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00039   \}
00040 
00041   \textcolor{comment}{// Auxiliaty variables.}
00042   QTextStream stream(&file); \textcolor{comment}{// Text stream used to parse lines.}
00043   int32\_t lineCnt = 0; \textcolor{comment}{// Current line counter, used to report errors.}
00044   int32\_t processedLines = 0; \textcolor{comment}{// Number of lines parsed during get methods.}
00045 
00046   \textcolor{comment}{// Read Number of bars.}
00047   int32\_t numBar;
00048   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"NumBarras"}, &numBar);
00049 
00050   \textcolor{keywordflow}{if}(processedLines == -1) \{
00051     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00052                           \textcolor{stringliteral}{"The file "} + fileName +
00053                           \textcolor{stringliteral}{" doesn't provide NumBarras."},
00054                           QMessageBox::Ok);
00055     file.close();
00056     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00057   \}
00058 
00059   lineCnt += processedLines;
00060 
00061   \textcolor{comment}{// Read Number of lines.}
00062   int32\_t numLine;
00063   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"NumLinhas"}, &numLine);
00064 
00065   \textcolor{keywordflow}{if}(processedLines == -1) \{
00066     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00067                           \textcolor{stringliteral}{"The file "} + fileName +
00068                           \textcolor{stringliteral}{" doesn't provide NumLinhas."},
00069                           QMessageBox::Ok);
00070     file.close();
00071     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00072   \}
00073 
00074   lineCnt += processedLines;
00075 
00076   \textcolor{comment}{// Get voltage base.}
00077   QString lineTxt;
00078   \textcolor{keywordtype}{double} voltageBase;
00079 
00080   \textcolor{keywordflow}{do} \{
00081     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00082       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00083                             \textcolor{stringliteral}{"The file "} + fileName +
00084                             \textcolor{stringliteral}{" doesn't provide the voltage base."},
00085                             QMessageBox::Ok);
00086       file.close();
00087       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00088     \}
00089 
00090     lineTxt = stream.readLine();
00091     lineCnt++;
00092   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Voltagem\_base\_da\_rede"}));
00093 
00094   stream >> voltageBase;
00095   network->\hyperlink{group___models_gac2787bb9c323716baa2e6fba06136f2b}{setVoltageBase}(voltageBase*1000.0/\hyperlink{math__constants_8h_a987f07b0b550988e3f3f9fb36d74142e}{kSQRT3});
00096 
00097   \textcolor{comment}{// Get Length Unit.}
00098   int32\_t LenUn;
00099   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"comprimento\_das\_linhas"}, &LenUn);
00100 
00101   \textcolor{keywordflow}{if}(processedLines == -1) \{
00102     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00103                           \textcolor{stringliteral}{"The file "} + fileName +
00104                           \textcolor{stringliteral}{" doesn't provide Length Unit."},
00105                           QMessageBox::Ok);
00106     file.close();
00107     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00108   \}
00109 
00110   lineCnt += processedLines;
00111 
00112   \textcolor{comment}{// Cast to Unit enum.}
00113   \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit} lengthUnit;
00114 
00115   \textcolor{keywordflow}{switch} (LenUn) \{
00116   \textcolor{keywordflow}{case} 1:
00117     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00118     \textcolor{keywordflow}{break};
00119 
00120   \textcolor{keywordflow}{case} 2:
00121     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a1c04f3dd196dbe1832a2658215b0d919}{Unit::kKiloMeter};
00122     \textcolor{keywordflow}{break};
00123 
00124   \textcolor{keywordflow}{case} 3:
00125     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a9ac9b167b0ebce477fb53d6ace04ddc8}{Unit::kFeet};
00126     \textcolor{keywordflow}{break};
00127 
00128   \textcolor{keywordflow}{case} 4:
00129     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a2ebde742068bbee0510de32fbb4cd724}{Unit::kMile};
00130     \textcolor{keywordflow}{break};
00131 
00132   \textcolor{keywordflow}{default}:
00133     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00134     \textcolor{keywordflow}{break};
00135   \}
00136 
00137   \textcolor{comment}{// Get Impedance Unit.}
00138   int32\_t ImpUn;
00139   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"impedancia"}, &ImpUn);
00140 
00141   \textcolor{keywordflow}{if}(processedLines == -1) \{
00142     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00143                           \textcolor{stringliteral}{"The file "} + fileName +
00144                           \textcolor{stringliteral}{" doesn't provide Impedance Unit."},
00145                           QMessageBox::Ok);
00146     file.close();
00147     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00148   \}
00149 
00150   lineCnt += processedLines;
00151 
00152 \textcolor{comment}{// Convert to enum.}
00153   \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit} impedanceUnit;
00154 
00155   \textcolor{keywordflow}{switch} (ImpUn) \{
00156   \textcolor{keywordflow}{case} 1:
00157     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00158     \textcolor{keywordflow}{break};
00159 
00160   \textcolor{keywordflow}{case} 2:
00161     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa35e9ca44deb5a35fdb576111cf0db336}{Unit::kOhmPerMeter};
00162     \textcolor{keywordflow}{break};
00163 
00164   \textcolor{keywordflow}{case} 3:
00165     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa56a0289d2ddeff7ca4aa8ba410df79d6}{Unit::kOhmPerKilometer};
00166     \textcolor{keywordflow}{break};
00167 
00168   \textcolor{keywordflow}{case} 4:
00169     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa433b57934ca3be960ec7a60f3ea6ea87}{Unit::kOhmPerFeet};
00170     \textcolor{keywordflow}{break};
00171 
00172   \textcolor{keywordflow}{case} 5:
00173     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa1d5bb04c9ecda66b09891af21cd4f613}{Unit::kOhmPerMile};
00174     \textcolor{keywordflow}{break};
00175 
00176   \textcolor{keywordflow}{default}:
00177     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00178     \textcolor{keywordflow}{break};
00179   \}
00180 
00181   \textcolor{comment}{// Get power Unit.}
00182   int32\_t powerUn;
00183   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Demanda"}, &powerUn);
00184 
00185   \textcolor{keywordflow}{if}(processedLines == -1) \{
00186     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00187                           \textcolor{stringliteral}{"The file "} + fileName +
00188                           \textcolor{stringliteral}{" doesn't provide Power Init."},
00189                           QMessageBox::Ok);
00190     file.close();
00191     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00192   \}
00193 
00194   lineCnt += processedLines;
00195 
00196   \textcolor{comment}{// Convert to enum.}
00197   \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit} powerUnit;
00198 
00199   \textcolor{keywordflow}{switch} (powerUn) \{
00200   \textcolor{keywordflow}{case} 1:
00201     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba72b181a842ae2759488a2fa1410d3696}{Unit::kVA};
00202     \textcolor{keywordflow}{break};
00203 
00204   \textcolor{keywordflow}{case} 2:
00205     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00206     \textcolor{keywordflow}{break};
00207 
00208   \textcolor{keywordflow}{case} 3:
00209     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba6039da0ed20f8bee64305bab8bdec365}{Unit::kMegaVa};
00210     \textcolor{keywordflow}{break};
00211 
00212   \textcolor{keywordflow}{default}:
00213     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00214     \textcolor{keywordflow}{break};
00215   \}
00216 
00217   \textcolor{comment}{// Get power base.}
00218   \textcolor{keywordtype}{double} powerBase;
00219 
00220   \textcolor{keywordflow}{do} \{
00221     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00222       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00223                             \textcolor{stringliteral}{"The file "} + fileName +
00224                             \textcolor{stringliteral}{" doesn't provide the power base."},
00225                             QMessageBox::Ok);
00226       file.close();
00227       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00228     \}
00229 
00230     lineTxt = stream.readLine();
00231     lineCnt++;
00232   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"kV\_hihg"}));
00233 
00234   QString dummy;
00235   stream >> dummy >> powerBase;
00236 
00237   network->\hyperlink{group___models_ga3ba9ef05ea0c5037a415cfab25d03a0d}{setPowerBase}(powerBase*1000.0/3);
00238 
00239   \textcolor{comment}{// Get Bars.}
00240   \textcolor{keywordflow}{do} \{
00241     lineTxt = stream.readLine();
00242     lineCnt++;
00243 
00244     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00245       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00246                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide bars."},
00247                             QMessageBox::Ok);
00248       file.close();
00249       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00250     \}
00251   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"[n"}));
00252 
00253   int32\_t id;
00254   int32\_t barType;
00255   \textcolor{keywordtype}{double} Sia, Siai;
00256   \textcolor{keywordtype}{double} Sib, Sibi;
00257   \textcolor{keywordtype}{double} Sic, Sici;
00258   \textcolor{keywordtype}{double} Sha, Shai;
00259   \textcolor{keywordtype}{double} Shb, Shbi;
00260   \textcolor{keywordtype}{double} Shc, Shci;
00261 
00262   int32\_t idBase = 0;
00263 
00264   \hyperlink{class_bar}{Bar} *bar;
00265 
00266   \textcolor{keywordflow}{for}(int32\_t i=0; i<numBar; i++) \{
00267     stream >> \textcolor{keywordtype}{id} >> barType >> Sia >> Siai >> Sib >> Sibi >> Sic >> Sici;
00268     stream >> Sha >> Shai >> Shb >> Shbi >> Shc >>Shci;
00269 
00270     \textcolor{keywordflow}{if}(barType == 3)
00271       idBase = id;
00272 
00273     bar = \textcolor{keyword}{new} \hyperlink{class_bar}{Bar};
00274     bar->\hyperlink{group___models_gae3cf341a76cc4589fe3203d0a3ed2ac0}{setBarId}(\textcolor{keywordtype}{id} - idBase);
00275 
00276     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_ga8c5dfef0216731246f7411e1a5fbee01}{addBar}(bar)) \{
00277       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Bar."},
00278                             \textcolor{stringliteral}{"Invalid Bar "} + QString::number(\textcolor{keywordtype}{id}) + \textcolor{stringliteral}{"at line "} +
00279                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
00280                             QMessageBox::Ok);
00281       \textcolor{keyword}{delete} bar;
00282       file.close();
00283       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00284     \}
00285 
00286     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(0, complex<double>(Sha, Shai), powerUnit);
00287     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(1, complex<double>(Shb, Shbi), powerUnit);
00288     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(2, complex<double>(Shc, Shci), powerUnit);
00289 
00290     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(0, complex<double>(Sia, Siai), powerUnit);
00291     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(1, complex<double>(Sib, Sibi), powerUnit);
00292     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(2, complex<double>(Sic, Sici), powerUnit);
00293 
00294     \textcolor{comment}{// Set Initial voltage to 1pu.}
00295     \textcolor{keywordtype}{double} initialVoltage = network->\hyperlink{group___models_ga88cd2506aaf0b19513e41f00608093e0}{voltageBase}();
00296 
00297     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(0, std::polar(initialVoltage, 0.0), \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00298     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(1, std::polar(initialVoltage, 120.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00299     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(2, std::polar(initialVoltage, 240.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00300 
00301     lineTxt = stream.readLine();
00302     lineCnt++;
00303   \}
00304 
00305 \textcolor{comment}{// Get Lines.}
00306   \textcolor{keywordflow}{do} \{
00307     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00308       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00309                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide lines."},
00310                             QMessageBox::Ok);
00311       file.close();
00312       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00313     \}
00314 
00315     lineTxt = stream.readLine();
00316     lineCnt++;
00317   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Tipo\_Cir"}));
00318 
00319   int32\_t noI, noF;
00320   \textcolor{keywordtype}{double} Zaa, Zaai;
00321   \textcolor{keywordtype}{double} Zab, Zabi;
00322   \textcolor{keywordtype}{double} Zac, Zaci;
00323   \textcolor{keywordtype}{double} Zbb, Zbbi;
00324   \textcolor{keywordtype}{double} Zbc, Zbci;
00325   \textcolor{keywordtype}{double} Zcc, Zcci;
00326   \textcolor{keywordtype}{double} length;
00327 
00328   \hyperlink{class_line}{Line} *line;
00329 
00330   \textcolor{keywordflow}{for}(int32\_t i=0; i<numLine; i++) \{
00331     stream >> dummy >> noI >> noF >> dummy >> dummy >> dummy >> dummy >> Zaa >> Zaai
00332            >> Zbb >> Zbbi >> Zcc;
00333     stream >> Zcci >> dummy >> dummy >> Zab >> Zabi >> Zac >> Zaci >> dummy >>
00334            dummy;
00335     stream >> Zbc >> Zbci >> dummy >> dummy >> dummy >> dummy >> dummy >>   length;
00336 
00337     line = \textcolor{keyword}{new} \hyperlink{class_line}{Line};
00338     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.first = noI - idBase;
00339     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.second = noF - idBase;
00340 
00341     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_gae02945131494987b3ff9b59b627719b4}{addLine}(line)) \{
00342       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Line."},
00343                             \textcolor{stringliteral}{"Invalid Line at line "} +
00344                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
00345                             QMessageBox::Ok);
00346       \textcolor{keyword}{delete} line;
00347       file.close();
00348       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00349     \}
00350 
00351     line->\hyperlink{group___models_ga950d0b8f5d167eda430c65ca7adadbb0}{setLength}(length, lengthUnit);
00352 
00353     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(0, complex<double>(Zaa, Zaai), impedanceUnit);
00354     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(1, complex<double>(Zab, Zabi), impedanceUnit);
00355     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(2, complex<double>(Zac, Zaci), impedanceUnit);
00356     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(3, complex<double>(Zbb, Zbbi), impedanceUnit);
00357     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(4, complex<double>(Zbc, Zbci), impedanceUnit);
00358     line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(5, complex<double>(Zcc, Zcci), impedanceUnit);
00359 
00360     lineTxt = stream.readLine();
00361     lineCnt++;
00362   \}
00363 
00364   \hyperlink{class_redraw_network}{RedrawNetwork} redraw(network);
00365   redraw.\hyperlink{group___algorithms_ga94d53ddf8ee00c4ef6d56bb988333103}{sugiyamaFast}();
00366 
00367   file.close();
00368   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00369 \}
00370 
\hypertarget{import_8cpp_source_l00371}{}\hyperlink{import_8h_aef466de21b145a0fdf215dd1a6409924}{00371} \textcolor{keywordtype}{bool} \hyperlink{import_8cpp_aef466de21b145a0fdf215dd1a6409924}{importTxtType2}(QString &fileName, \hyperlink{class_network}{Network} *network)
00372 \{
00373   QFile file(fileName);
00374 
00375   \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly)) \{
00376     QMessageBox::critical(NULL, \textcolor{stringliteral}{"File read error."},
00377                           \textcolor{stringliteral}{"Can\(\backslash\)'t read "} + file.fileName() + \textcolor{stringliteral}{"."},
00378                           QMessageBox::Ok);
00379     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00380   \}
00381 
00382   \textcolor{comment}{// Auxiliaty variables.}
00383   QTextStream stream(&file); \textcolor{comment}{// Text stream used to parse lines.}
00384   int32\_t lineCnt = 0; \textcolor{comment}{// Current line counter, used to report errors.}
00385   int32\_t processedLines = 0; \textcolor{comment}{// Number of lines parsed during get methods.}
00386 
00387   \textcolor{comment}{// Read Number of bars.}
00388   int32\_t numBar;
00389   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Numero\_barras"}, &numBar);
00390 
00391   \textcolor{keywordflow}{if}(processedLines == -1) \{
00392     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00393                           \textcolor{stringliteral}{"The file "} + fileName +
00394                           \textcolor{stringliteral}{" doesn't provide Numero\_barras."},
00395                           QMessageBox::Ok);
00396     file.close();
00397     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00398   \}
00399 
00400   lineCnt += processedLines;
00401 
00402   \textcolor{comment}{// Read Number of lines.}
00403   int32\_t numLine;
00404   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Numero\_linhas"}, &numLine);
00405 
00406   \textcolor{keywordflow}{if}(processedLines == -1) \{
00407     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00408                           \textcolor{stringliteral}{"The file "} + fileName +
00409                           \textcolor{stringliteral}{" doesn't provide Numero\_linhas."},
00410                           QMessageBox::Ok);
00411     file.close();
00412     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00413   \}
00414 
00415   lineCnt += processedLines;
00416 
00417   \textcolor{comment}{// Get voltage base.}
00418   QString lineTxt;
00419   \textcolor{keywordtype}{double} voltageBase;
00420 
00421   \textcolor{keywordflow}{do} \{
00422     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00423       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00424                             \textcolor{stringliteral}{"The file "} + fileName +
00425                             \textcolor{stringliteral}{" doesn't provide the voltage base."},
00426                             QMessageBox::Ok);
00427       file.close();
00428       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00429     \}
00430 
00431     lineTxt = stream.readLine();
00432     lineCnt++;
00433   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Voltagem\_base\_da\_rede"}));
00434 
00435   stream >> voltageBase;
00436   network->\hyperlink{group___models_gac2787bb9c323716baa2e6fba06136f2b}{setVoltageBase}(voltageBase*1000.0/\hyperlink{math__constants_8h_a987f07b0b550988e3f3f9fb36d74142e}{kSQRT3});
00437 
00438 
00439   \textcolor{comment}{// Get Length Unit.}
00440   int32\_t LenUn;
00441   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"comprimento\_das\_linhas"}, &LenUn);
00442 
00443   \textcolor{keywordflow}{if}(processedLines == -1) \{
00444     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00445                           \textcolor{stringliteral}{"The file "} + fileName +
00446                           \textcolor{stringliteral}{" doesn't provide Length Unit."},
00447                           QMessageBox::Ok);
00448     file.close();
00449     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00450   \}
00451 
00452   lineCnt += processedLines;
00453 
00454   \textcolor{comment}{// Cast to Unit enum.}
00455   \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit} lengthUnit;
00456 
00457   \textcolor{keywordflow}{switch} (LenUn) \{
00458   \textcolor{keywordflow}{case} 1:
00459     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00460     \textcolor{keywordflow}{break};
00461 
00462   \textcolor{keywordflow}{case} 2:
00463     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a1c04f3dd196dbe1832a2658215b0d919}{Unit::kKiloMeter};
00464     \textcolor{keywordflow}{break};
00465 
00466   \textcolor{keywordflow}{case} 3:
00467     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a9ac9b167b0ebce477fb53d6ace04ddc8}{Unit::kFeet};
00468     \textcolor{keywordflow}{break};
00469 
00470   \textcolor{keywordflow}{case} 4:
00471     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a2ebde742068bbee0510de32fbb4cd724}{Unit::kMile};
00472     \textcolor{keywordflow}{break};
00473 
00474   \textcolor{keywordflow}{default}:
00475     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00476     \textcolor{keywordflow}{break};
00477   \}
00478 
00479   \textcolor{comment}{// Get Impedance Unit.}
00480   int32\_t ImpUn;
00481   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"impedancia"}, &ImpUn);
00482 
00483   \textcolor{keywordflow}{if}(processedLines == -1) \{
00484     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00485                           \textcolor{stringliteral}{"The file "} + fileName +
00486                           \textcolor{stringliteral}{" doesn't provide Impedance Unit."},
00487                           QMessageBox::Ok);
00488     file.close();
00489     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00490   \}
00491 
00492   lineCnt += processedLines;
00493 
00494   \textcolor{comment}{// Convert to enum.}
00495   \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit} impedanceUnit;
00496 
00497   \textcolor{keywordflow}{switch} (ImpUn) \{
00498   \textcolor{keywordflow}{case} 1:
00499     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00500     \textcolor{keywordflow}{break};
00501 
00502   \textcolor{keywordflow}{case} 2:
00503     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa35e9ca44deb5a35fdb576111cf0db336}{Unit::kOhmPerMeter};
00504     \textcolor{keywordflow}{break};
00505 
00506   \textcolor{keywordflow}{case} 3:
00507     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa56a0289d2ddeff7ca4aa8ba410df79d6}{Unit::kOhmPerKilometer};
00508     \textcolor{keywordflow}{break};
00509 
00510   \textcolor{keywordflow}{case} 4:
00511     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa433b57934ca3be960ec7a60f3ea6ea87}{Unit::kOhmPerFeet};
00512     \textcolor{keywordflow}{break};
00513 
00514   \textcolor{keywordflow}{case} 5:
00515     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa1d5bb04c9ecda66b09891af21cd4f613}{Unit::kOhmPerMile};
00516     \textcolor{keywordflow}{break};
00517 
00518   \textcolor{keywordflow}{default}:
00519     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00520     \textcolor{keywordflow}{break};
00521   \}
00522 
00523   \textcolor{comment}{// Get power Unit.}
00524   int32\_t powerUn;
00525   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Demanda"}, &powerUn);
00526 
00527   \textcolor{keywordflow}{if}(processedLines == -1) \{
00528     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00529                           \textcolor{stringliteral}{"The file "} + fileName +
00530                           \textcolor{stringliteral}{" doesn't provide Power Init."},
00531                           QMessageBox::Ok);
00532     file.close();
00533     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00534   \}
00535 
00536   lineCnt += processedLines;
00537 
00538   \textcolor{comment}{// Convert to enum.}
00539   \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit} powerUnit;
00540 
00541   \textcolor{keywordflow}{switch} (powerUn) \{
00542   \textcolor{keywordflow}{case} 1:
00543     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba72b181a842ae2759488a2fa1410d3696}{Unit::kVA};
00544     \textcolor{keywordflow}{break};
00545 
00546   \textcolor{keywordflow}{case} 2:
00547     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00548     \textcolor{keywordflow}{break};
00549 
00550   \textcolor{keywordflow}{case} 3:
00551     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba6039da0ed20f8bee64305bab8bdec365}{Unit::kMegaVa};
00552     \textcolor{keywordflow}{break};
00553 
00554   \textcolor{keywordflow}{default}:
00555     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00556     \textcolor{keywordflow}{break};
00557   \}
00558 
00559   \textcolor{comment}{// Get power base.}
00560   \textcolor{keywordtype}{double} powerBase;
00561 
00562   \textcolor{keywordflow}{do} \{
00563     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00564       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00565                             \textcolor{stringliteral}{"The file "} + fileName +
00566                             \textcolor{stringliteral}{" doesn't provide the power base."},
00567                             QMessageBox::Ok);
00568       file.close();
00569       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00570     \}
00571 
00572     lineTxt = stream.readLine();
00573     lineCnt++;
00574   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"kV\_hihg"}));
00575 
00576   QString dummy;
00577   stream >> dummy >> powerBase;
00578 
00579   network->\hyperlink{group___models_ga3ba9ef05ea0c5037a415cfab25d03a0d}{setPowerBase}(powerBase*1000.0/3);
00580 
00581 
00582   \textcolor{comment}{// Get Bars.}
00583   \textcolor{keywordflow}{do} \{
00584     lineTxt = stream.readLine();
00585     lineCnt++;
00586 
00587     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00588       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00589                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide bars."},
00590                             QMessageBox::Ok);
00591       file.close();
00592       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00593     \}
00594   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Barra"}));
00595 
00596   int32\_t id;
00597   int32\_t barType;
00598   \textcolor{keywordtype}{double} Sia, Siai;
00599   \textcolor{keywordtype}{double} Sib, Sibi;
00600   \textcolor{keywordtype}{double} Sic, Sici;
00601   \textcolor{keywordtype}{double} Sha, Shai;
00602   \textcolor{keywordtype}{double} Shb, Shbi;
00603   \textcolor{keywordtype}{double} Shc, Shci;
00604 
00605   int32\_t idBase = 0;
00606 
00607   \hyperlink{class_bar}{Bar} *bar;
00608 
00609   \textcolor{keywordflow}{for}(int32\_t i=0; i<numBar; i++) \{
00610     stream >> \textcolor{keywordtype}{id} >> barType >> Sia >> Siai >> Sib >> Sibi >> Sic >> Sici;
00611     stream >> Sha >> Shai >> Shb >> Shbi >> Shc >>Shci;
00612 
00613     \textcolor{keywordflow}{if}(barType == 3)
00614       idBase = id;
00615 
00616     bar = \textcolor{keyword}{new} \hyperlink{class_bar}{Bar};
00617     bar->\hyperlink{group___models_gae3cf341a76cc4589fe3203d0a3ed2ac0}{setBarId}(\textcolor{keywordtype}{id} - idBase);
00618 
00619     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_ga8c5dfef0216731246f7411e1a5fbee01}{addBar}(bar)) \{
00620       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Bar."},
00621                             \textcolor{stringliteral}{"Invalid Bar "} + QString::number(\textcolor{keywordtype}{id}) + \textcolor{stringliteral}{"at line "} +
00622                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
00623                             QMessageBox::Ok);
00624       \textcolor{keyword}{delete} bar;
00625       file.close();
00626       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00627     \}
00628 
00629     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(0, complex<double>(Sha, Shai), powerUnit);
00630     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(1, complex<double>(Shb, Shbi), powerUnit);
00631     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(2, complex<double>(Shc, Shci), powerUnit);
00632 
00633     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(0, complex<double>(Sia, Siai), powerUnit);
00634     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(1, complex<double>(Sib, Sibi), powerUnit);
00635     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(2, complex<double>(Sic, Sici), powerUnit);
00636 
00637     \textcolor{comment}{// Set Initial voltage to 1pu.}
00638     \textcolor{keywordtype}{double} initialVoltage = network->\hyperlink{group___models_ga88cd2506aaf0b19513e41f00608093e0}{voltageBase}();
00639 
00640     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(0, std::polar(initialVoltage, 0.0), \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00641     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(1, std::polar(initialVoltage, 120.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00642     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(2, std::polar(initialVoltage, 240.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00643 
00644     lineTxt = stream.readLine();
00645     lineCnt++;
00646   \}
00647 
00648   \textcolor{comment}{// Get Lines.}
00649   \textcolor{keywordflow}{do} \{
00650     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00651       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00652                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide lines."},
00653                             QMessageBox::Ok);
00654       file.close();
00655       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00656     \}
00657 
00658     lineTxt = stream.readLine();
00659     lineCnt++;
00660   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Tipo\_Cir"}));
00661 
00662   int32\_t noI, noF;
00663   \textcolor{keywordtype}{double} Zaa, Zaai;
00664   \textcolor{keywordtype}{double} Zab, Zabi;
00665   \textcolor{keywordtype}{double} Zac, Zaci;
00666   \textcolor{keywordtype}{double} Zbb, Zbbi;
00667   \textcolor{keywordtype}{double} Zbc, Zbci;
00668   \textcolor{keywordtype}{double} Zcc, Zcci;
00669   \textcolor{keywordtype}{double} length;
00670   QString lineType;
00671 
00672   \hyperlink{class_line}{Line} *line;
00673 
00674   \textcolor{keywordflow}{for}(int32\_t i=0; i<numLine; i++) \{
00675     line = \textcolor{keyword}{new} \hyperlink{class_line}{Line};
00676     stream >> lineType >> noI >> noF;
00677     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.first = noI - idBase;
00678     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.second = noF - idBase;
00679 
00680     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_gae02945131494987b3ff9b59b627719b4}{addLine}(line)) \{
00681       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Line."},
00682                             \textcolor{stringliteral}{"Invalid Line at line "} +
00683                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
00684                             QMessageBox::Ok);
00685       \textcolor{keyword}{delete} line;
00686       file.close();
00687       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00688     \}
00689 
00690     \textcolor{keywordflow}{if} (lineType.contains(\textcolor{stringliteral}{"CP"})) \{
00691       stream >> Zaa >> Zaai >> Zbb >> Zbbi >> Zcc;
00692       stream >> Zcci >> dummy >> dummy >> Zab >> Zabi >> Zac >> Zaci >> dummy;
00693       stream >> dummy >> Zbc >> Zbci >> dummy >> dummy >> dummy >> dummy;
00694       stream >> dummy >> length;
00695 
00696       line->\hyperlink{group___models_ga950d0b8f5d167eda430c65ca7adadbb0}{setLength}(length, lengthUnit);
00697 
00698       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(0, complex<double>(Zaa, Zaai), impedanceUnit);
00699       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(1, complex<double>(Zab, Zabi), impedanceUnit);
00700       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(2, complex<double>(Zac, Zaci), impedanceUnit);
00701       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(3, complex<double>(Zbb, Zbbi), impedanceUnit);
00702       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(4, complex<double>(Zbc, Zbci), impedanceUnit);
00703       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(5, complex<double>(Zcc, Zcci), impedanceUnit);
00704     \}
00705 
00706     lineTxt = stream.readLine();
00707     lineCnt++;
00708   \}
00709 
00710   \hyperlink{class_redraw_network}{RedrawNetwork} redraw(network);
00711   redraw.\hyperlink{group___algorithms_ga94d53ddf8ee00c4ef6d56bb988333103}{sugiyamaFast}();
00712 
00713   file.close();
00714   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00715 \}
00716 
\hypertarget{import_8cpp_source_l00717}{}\hyperlink{import_8h_acd1a54d4b2a28043b1489f0be7423ecd}{00717} \textcolor{keywordtype}{bool} \hyperlink{import_8cpp_acd1a54d4b2a28043b1489f0be7423ecd}{importTxtType3}(QString &fileName, \hyperlink{class_network}{Network} *network)
00718 \{
00719   QFile file(fileName);
00720 
00721   \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly)) \{
00722     QMessageBox::critical(NULL, \textcolor{stringliteral}{"File read error."},
00723                           \textcolor{stringliteral}{"Can\(\backslash\)'t read "} + file.fileName() + \textcolor{stringliteral}{"."},
00724                           QMessageBox::Ok);
00725     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00726   \}
00727 
00728   \textcolor{comment}{// Auxiliaty variables.}
00729   QTextStream stream(&file); \textcolor{comment}{// Text stream used to parse lines.}
00730   int32\_t lineCnt = 0; \textcolor{comment}{// Current line counter, used to report errors.}
00731   int32\_t processedLines = 0; \textcolor{comment}{// Number of lines parsed during get methods.}
00732 
00733   \textcolor{comment}{// Read Number of bars.}
00734   int32\_t numBar;
00735   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Numero\_barras"}, &numBar);
00736 
00737   \textcolor{keywordflow}{if}(processedLines == -1) \{
00738     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00739                           \textcolor{stringliteral}{"The file "} + fileName +
00740                           \textcolor{stringliteral}{" doesn't provide Numero\_barras."},
00741                           QMessageBox::Ok);
00742     file.close();
00743     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00744   \}
00745 
00746   lineCnt += processedLines;
00747 
00748   \textcolor{comment}{// Read Number of lines.}
00749   int32\_t numLine;
00750   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Numero\_linhas"}, &numLine);
00751 
00752   \textcolor{keywordflow}{if}(processedLines == -1) \{
00753     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00754                           \textcolor{stringliteral}{"The file "} + fileName +
00755                           \textcolor{stringliteral}{" doesn't provide Numero\_linhas."},
00756                           QMessageBox::Ok);
00757     file.close();
00758     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00759   \}
00760 
00761   lineCnt += processedLines;
00762 
00763   \textcolor{comment}{// Get voltage base.}
00764   QString lineTxt;
00765   \textcolor{keywordtype}{double} voltageBase;
00766 
00767   \textcolor{keywordflow}{do} \{
00768     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00769       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00770                             \textcolor{stringliteral}{"The file "} + fileName +
00771                             \textcolor{stringliteral}{" doesn't provide the voltage base."},
00772                             QMessageBox::Ok);
00773       file.close();
00774       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00775     \}
00776 
00777     lineTxt = stream.readLine();
00778     lineCnt++;
00779   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Voltagem\_base\_da\_rede"}));
00780 
00781   stream >> voltageBase;
00782   network->\hyperlink{group___models_gac2787bb9c323716baa2e6fba06136f2b}{setVoltageBase}(voltageBase*1000.0/\hyperlink{math__constants_8h_a987f07b0b550988e3f3f9fb36d74142e}{kSQRT3});
00783 
00784 
00785   \textcolor{comment}{// Get Length Unit.}
00786   int32\_t LenUn;
00787   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"comprimento\_das\_linhas"}, &LenUn);
00788 
00789   \textcolor{keywordflow}{if}(processedLines == -1) \{
00790     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00791                           \textcolor{stringliteral}{"The file "} + fileName +
00792                           \textcolor{stringliteral}{" doesn't provide Length Unit."},
00793                           QMessageBox::Ok);
00794     file.close();
00795     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00796   \}
00797 
00798   lineCnt += processedLines;
00799 
00800   \textcolor{comment}{// Cast to Unit enum.}
00801   \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0}{Unit::LengthUnit} lengthUnit;
00802 
00803   \textcolor{keywordflow}{switch} (LenUn) \{
00804   \textcolor{keywordflow}{case} 1:
00805     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00806     \textcolor{keywordflow}{break};
00807 
00808   \textcolor{keywordflow}{case} 2:
00809     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a1c04f3dd196dbe1832a2658215b0d919}{Unit::kKiloMeter};
00810     \textcolor{keywordflow}{break};
00811 
00812   \textcolor{keywordflow}{case} 3:
00813     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a9ac9b167b0ebce477fb53d6ace04ddc8}{Unit::kFeet};
00814     \textcolor{keywordflow}{break};
00815 
00816   \textcolor{keywordflow}{case} 4:
00817     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0a2ebde742068bbee0510de32fbb4cd724}{Unit::kMile};
00818     \textcolor{keywordflow}{break};
00819 
00820   \textcolor{keywordflow}{default}:
00821     lengthUnit = \hyperlink{class_unit_a8c8921f7b225ad6063b1cb573425b9a0abfa41ebe7ee649a1f02c9b8ae570434b}{Unit::kMeter};
00822     \textcolor{keywordflow}{break};
00823   \}
00824 
00825   \textcolor{comment}{// Get Impedance Unit.}
00826   int32\_t ImpUn;
00827   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"impedancia"}, &ImpUn);
00828 
00829   \textcolor{keywordflow}{if}(processedLines == -1) \{
00830     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00831                           \textcolor{stringliteral}{"The file "} + fileName +
00832                           \textcolor{stringliteral}{" doesn't provide Impedance Unit."},
00833                           QMessageBox::Ok);
00834     file.close();
00835     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00836   \}
00837 
00838   lineCnt += processedLines;
00839 
00840   \textcolor{comment}{// Convert to enum.}
00841   \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdf}{Unit::ImpedanceUnit} impedanceUnit;
00842 
00843   \textcolor{keywordflow}{switch} (ImpUn) \{
00844   \textcolor{keywordflow}{case} 1:
00845     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00846     \textcolor{keywordflow}{break};
00847 
00848   \textcolor{keywordflow}{case} 2:
00849     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa35e9ca44deb5a35fdb576111cf0db336}{Unit::kOhmPerMeter};
00850     \textcolor{keywordflow}{break};
00851 
00852   \textcolor{keywordflow}{case} 3:
00853     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa56a0289d2ddeff7ca4aa8ba410df79d6}{Unit::kOhmPerKilometer};
00854     \textcolor{keywordflow}{break};
00855 
00856   \textcolor{keywordflow}{case} 4:
00857     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa433b57934ca3be960ec7a60f3ea6ea87}{Unit::kOhmPerFeet};
00858     \textcolor{keywordflow}{break};
00859 
00860   \textcolor{keywordflow}{case} 5:
00861     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa1d5bb04c9ecda66b09891af21cd4f613}{Unit::kOhmPerMile};
00862     \textcolor{keywordflow}{break};
00863 
00864   \textcolor{keywordflow}{default}:
00865     impedanceUnit = \hyperlink{class_unit_a3747e779c805df24a71961290be3fbdfa6b9c74d1763eefbaf751eeecff0bd9da}{Unit::kOhm};
00866     \textcolor{keywordflow}{break};
00867   \}
00868 
00869   \textcolor{comment}{// Get power Unit.}
00870   int32\_t powerUn;
00871   processedLines = getNextLineInt(&stream, \textcolor{stringliteral}{"Demanda"}, &powerUn);
00872 
00873   \textcolor{keywordflow}{if}(processedLines == -1) \{
00874     QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00875                           \textcolor{stringliteral}{"The file "} + fileName +
00876                           \textcolor{stringliteral}{" doesn't provide Power Init."},
00877                           QMessageBox::Ok);
00878     file.close();
00879     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00880   \}
00881 
00882   lineCnt += processedLines;
00883 
00884   \textcolor{comment}{// Convert to enum.}
00885   \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3b}{Unit::PowerUnit} powerUnit;
00886 
00887   \textcolor{keywordflow}{switch} (powerUn) \{
00888   \textcolor{keywordflow}{case} 1:
00889     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba72b181a842ae2759488a2fa1410d3696}{Unit::kVA};
00890     \textcolor{keywordflow}{break};
00891 
00892   \textcolor{keywordflow}{case} 2:
00893     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00894     \textcolor{keywordflow}{break};
00895 
00896   \textcolor{keywordflow}{case} 3:
00897     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3ba6039da0ed20f8bee64305bab8bdec365}{Unit::kMegaVa};
00898     \textcolor{keywordflow}{break};
00899 
00900   \textcolor{keywordflow}{default}:
00901     powerUnit = \hyperlink{class_unit_ace265ae255370ccacfd5370337572c3bac9e5154522fbb810d7aed75c3ff47cb2}{Unit::kKiloVA};
00902     \textcolor{keywordflow}{break};
00903   \}
00904 
00905   \textcolor{comment}{// Get power base.}
00906   \textcolor{keywordtype}{double} powerBase;
00907 
00908   \textcolor{keywordflow}{do} \{
00909     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00910       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00911                             \textcolor{stringliteral}{"The file "} + fileName +
00912                             \textcolor{stringliteral}{" doesn't provide the power base."},
00913                             QMessageBox::Ok);
00914       file.close();
00915       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00916     \}
00917 
00918     lineTxt = stream.readLine();
00919     lineCnt++;
00920   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"kV\_hihg"}));
00921 
00922   QString dummy;
00923   stream >> dummy >> powerBase;
00924 
00925   network->\hyperlink{group___models_ga3ba9ef05ea0c5037a415cfab25d03a0d}{setPowerBase}(powerBase*1000.0/3);
00926 
00927   \textcolor{comment}{// Get Bars.}
00928   \textcolor{keywordflow}{do} \{
00929     lineTxt = stream.readLine();
00930     lineCnt++;
00931 
00932     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00933       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00934                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide bars."},
00935                             QMessageBox::Ok);
00936       file.close();
00937       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00938     \}
00939   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Barra"}));
00940 
00941   int32\_t id;
00942   int32\_t barType;
00943   \textcolor{keywordtype}{double} Sia, Siai;
00944   \textcolor{keywordtype}{double} Sib, Sibi;
00945   \textcolor{keywordtype}{double} Sic, Sici;
00946   \textcolor{keywordtype}{double} Sha, Shai;
00947   \textcolor{keywordtype}{double} Shb, Shbi;
00948   \textcolor{keywordtype}{double} Shc, Shci;
00949 
00950   int32\_t idBase = 0;
00951 
00952   \hyperlink{class_bar}{Bar} *bar;
00953 
00954   \textcolor{keywordflow}{for}(int32\_t i=0; i<numBar; i++) \{
00955     stream >> \textcolor{keywordtype}{id} >> barType >> Sia >> Siai >> Sib >> Sibi >> Sic >> Sici;
00956     stream >> Sha >> Shai >> Shb >> Shbi >> Shc >>Shci;
00957 
00958     \textcolor{keywordflow}{if}(barType == 3)
00959       idBase = id;
00960 
00961     bar = \textcolor{keyword}{new} \hyperlink{class_bar}{Bar};
00962     bar->\hyperlink{group___models_gae3cf341a76cc4589fe3203d0a3ed2ac0}{setBarId}(\textcolor{keywordtype}{id} - idBase);
00963 
00964     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_ga8c5dfef0216731246f7411e1a5fbee01}{addBar}(bar)) \{
00965       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Bar."},
00966                             \textcolor{stringliteral}{"Invalid Bar "} + QString::number(\textcolor{keywordtype}{id}) + \textcolor{stringliteral}{"at line "} +
00967                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
00968                             QMessageBox::Ok);
00969       \textcolor{keyword}{delete} bar;
00970       file.close();
00971       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00972     \}
00973 
00974     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(0, complex<double>(Sha, Shai), powerUnit);
00975     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(1, complex<double>(Shb, Shbi), powerUnit);
00976     bar->\hyperlink{group___models_gafd91c7f15566b9d5a68a197efeaeaf26}{setSh}(2, complex<double>(Shc, Shci), powerUnit);
00977 
00978     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(0, complex<double>(Sia, Siai), powerUnit);
00979     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(1, complex<double>(Sib, Sibi), powerUnit);
00980     bar->\hyperlink{group___models_ga85e2a9b8a281900333fd65d1b532acfd}{setSi}(2, complex<double>(Sic, Sici), powerUnit);
00981 
00982     \textcolor{comment}{// Set Initial voltage to 1pu.}
00983     \textcolor{keywordtype}{double} initialVoltage = network->\hyperlink{group___models_ga88cd2506aaf0b19513e41f00608093e0}{voltageBase}();
00984 
00985     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(0, std::polar(initialVoltage, 0.0), \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00986     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(1, std::polar(initialVoltage, 120.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00987     bar->\hyperlink{group___models_ga8d1e70b2d11ed4245e81b8b20858079d}{setV}(2, std::polar(initialVoltage, 240.0*\hyperlink{math__constants_8h_a368d99984512d9a6c6f18b37b4446431}{kPI}/180.0), 
      \hyperlink{class_unit_a55b07dfa9457e1eca2c7194fe0cfc3c1aa54b2473993a702a3923525765bd6e4c}{Unit::kVolts});
00988 
00989 
00990     lineTxt = stream.readLine();
00991     lineCnt++;
00992   \}
00993 
00994   \textcolor{comment}{// Get Lines.}
00995   \textcolor{keywordflow}{do} \{
00996     \textcolor{keywordflow}{if}(stream.atEnd()) \{
00997       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid File."},
00998                             \textcolor{stringliteral}{"The file "} + fileName + \textcolor{stringliteral}{" doesn't provide lines."},
00999                             QMessageBox::Ok);
01000       file.close();
01001       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
01002     \}
01003 
01004     lineTxt = stream.readLine();
01005     lineCnt++;
01006   \} \textcolor{keywordflow}{while}(!lineTxt.contains(\textcolor{stringliteral}{"Tipo\_Cir"}));
01007 
01008   int32\_t noI, noF;
01009   \textcolor{keywordtype}{double} Zaa, Zaai;
01010   \textcolor{keywordtype}{double} Zab, Zabi;
01011   \textcolor{keywordtype}{double} Zac, Zaci;
01012   \textcolor{keywordtype}{double} Zbb, Zbbi;
01013   \textcolor{keywordtype}{double} Zbc, Zbci;
01014   \textcolor{keywordtype}{double} Zcc, Zcci;
01015   \textcolor{keywordtype}{double} length;
01016   QString lineType;
01017 
01018   \hyperlink{class_line}{Line} *line;
01019 
01020   \textcolor{keywordflow}{for}(int32\_t i=0; i<numLine; i++) \{
01021     line = \textcolor{keyword}{new} \hyperlink{class_line}{Line};
01022     stream >> lineType >> noI >> noF;
01023     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.first = noI - idBase;
01024     line->\hyperlink{class_line_afd17c40d656e6a8d677cb22df5f0c70b}{nodes}.second = noF - idBase;
01025 
01026     \textcolor{keywordflow}{if} (!network->\hyperlink{group___models_gae02945131494987b3ff9b59b627719b4}{addLine}(line)) \{
01027       QMessageBox::critical(NULL, \textcolor{stringliteral}{"Invalid Line."},
01028                             \textcolor{stringliteral}{"Invalid Line at line "} +
01029                             QString::number(lineCnt) + \textcolor{stringliteral}{"."},
01030                             QMessageBox::Ok);
01031       \textcolor{keyword}{delete} line;
01032       file.close();
01033       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
01034     \}
01035 
01036     \textcolor{keywordflow}{if} (lineType.contains(\textcolor{stringliteral}{"CP"})) \{
01037       stream >> dummy >> dummy >> dummy >> dummy >> Zaa >> Zaai >> Zbb >> Zbbi;
01038       stream >> Zcc >> Zcci >> dummy >> dummy >> Zab >> Zabi >> Zac >> Zaci;
01039       stream >> dummy >> dummy >> Zbc >> Zbci >> dummy >> dummy >> dummy;
01040       stream >> dummy >> dummy >> length;
01041 
01042       line->\hyperlink{group___models_ga950d0b8f5d167eda430c65ca7adadbb0}{setLength}(length, lengthUnit);
01043 
01044       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(0, complex<double>(Zaa, Zaai), impedanceUnit);
01045       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(1, complex<double>(Zab, Zabi), impedanceUnit);
01046       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(2, complex<double>(Zac, Zaci), impedanceUnit);
01047       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(3, complex<double>(Zbb, Zbbi), impedanceUnit);
01048       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(4, complex<double>(Zbc, Zbci), impedanceUnit);
01049       line->\hyperlink{group___models_ga2b8fe47ae4ae2d4422d9431e17b4927d}{setZ}(5, complex<double>(Zcc, Zcci), impedanceUnit);
01050     \}
01051 
01052     lineTxt = stream.readLine();
01053     lineCnt++;
01054   \}
01055 
01056   \hyperlink{class_redraw_network}{RedrawNetwork} redraw(network);
01057   redraw.\hyperlink{group___algorithms_ga94d53ddf8ee00c4ef6d56bb988333103}{sugiyamaFast}();
01058 
01059   file.close();
01060   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
01061 \}
\end{DoxyCode}
